import{g as ct}from"./index.BbP3371Q.js";import{c as p,g as Dr}from"./_commonjsHelpers.C4iS2aBk.js";import{B as M}from"./entry.2io2w4A1.js";import{k as Bt,d as Kr,a as Ht,c as zt,f as Fr,u as Cr,r as Lr,g as kr}from"./browser-index.dg0Wmlfm.js";import{s as Ut}from"./sha256.CF7BB7bq.js";var xt={},ye={},J={},Q={},re=p&&p.__awaiter||function(e,r,t,n){function o(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function s(a){try{d(n.next(a))}catch(l){c(l)}}function u(a){try{d(n.throw(a))}catch(l){c(l)}}function d(a){a.done?i(a.value):o(a.value).then(s,u)}d((n=n.apply(e,r||[])).next())})};Object.defineProperty(Q,"__esModule",{value:!0});Q.StateStorage=void 0;class Br{constructor(){this.dataKey="herewallet:keystore"}setState(r,t){return re(this,void 0,void 0,function*(){const n=yield this.getFullState();n[r]=t,window.localStorage.setItem(this.dataKey,JSON.stringify(n))})}getFullState(){return re(this,void 0,void 0,function*(){try{return JSON.parse(window.localStorage.getItem(this.dataKey))||{}}catch{return{}}})}getState(r){return re(this,void 0,void 0,function*(){return(yield this.getFullState())[r]||{activeAccount:null,accounts:{}}})}clear(){return re(this,void 0,void 0,function*(){window.localStorage.removeItem(this.dataKey)})}}Q.StateStorage=Br;var C=p&&p.__awaiter||function(e,r,t,n){function o(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function s(a){try{d(n.next(a))}catch(l){c(l)}}function u(a){try{d(n.throw(a))}catch(l){c(l)}}function d(a){a.done?i(a.value):o(a.value).then(s,u)}d((n=n.apply(e,r||[])).next())})};Object.defineProperty(J,"__esModule",{value:!0});J.HereKeyStore=void 0;const Hr=Bt,zr=Q;class Ur{constructor(r=new zr.StateStorage){this.storage=r}setActiveAccount(r,t){return C(this,void 0,void 0,function*(){const n=yield this.storage.getState(r);n.activeAccount=t,this.storage.setState(r,n)})}setKey(r,t,n){return C(this,void 0,void 0,function*(){const o=yield this.storage.getState(r);o.accounts[t]=n.toString(),this.storage.setState(r,o)})}getAccounts(r){return C(this,void 0,void 0,function*(){const t=yield this.storage.getState(r);return Object.keys(t.accounts)})}getActiveAccount(r){return C(this,void 0,void 0,function*(){return(yield this.storage.getState(r)).activeAccount})}getKey(r,t){return C(this,void 0,void 0,function*(){const o=(yield this.storage.getState(r)).accounts[t];if(o==null)throw Error(`For ${t} in ${r} network key not found`);return Hr.KeyPair.fromString(o)})}removeKey(r,t){return C(this,void 0,void 0,function*(){let n=yield this.storage.getState(r);n.activeAccount===t&&(n.activeAccount=null),delete n.accounts[t],this.storage.setState(r,n)})}getNetworks(){return C(this,void 0,void 0,function*(){let r=yield this.storage.getFullState();return Object.keys(r.accounts)})}clear(){return C(this,void 0,void 0,function*(){yield this.storage.clear()})}}J.HereKeyStore=Ur;var Z={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HereProviderError=e.HereProviderStatus=void 0,function(t){t[t.APPROVING=1]="APPROVING",t[t.FAILED=2]="FAILED",t[t.SUCCESS=3]="SUCCESS"}(e.HereProviderStatus||(e.HereProviderStatus={}));class r extends Error{constructor(n,o){super(n??(o==null?void 0:o.message)),this.payload=n,this.parentError=o}}e.HereProviderError=r})(Z);var m={};const xr=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;function Wt(e){return xr.test(e)}function Le(){var e=URL.createObjectURL(new Blob),r=e.toString();return URL.revokeObjectURL(e),r.split(/[:\/]/g).pop().toLowerCase()}Le.valid=Wt;const Wr=Object.freeze(Object.defineProperty({__proto__:null,default:Le,uuid4:Le,valid:Wt},Symbol.toStringTag,{value:"Module"})),qt=Dr(Wr);var qr=p&&p.__awaiter||function(e,r,t,n){function o(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function s(a){try{d(n.next(a))}catch(l){c(l)}}function u(a){try{d(n.throw(a))}catch(l){c(l)}}function d(a){a.done?i(a.value):o(a.value).then(s,u)}d((n=n.apply(e,r||[])).next())})},Gr=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});m.isValidAccessKey=m.internalThrow=m.getPublicKeys=m.serializeActions=m.isMobile=m.getDeviceId=void 0;const Vr=Gr(qt),st=Z,Yr=()=>{const e=window.localStorage.getItem("herewallet-topic")||(0,Vr.default)();return window.localStorage.setItem("herewallet-topic",e),e};m.getDeviceId=Yr;const Jr=()=>window.matchMedia("(any-pointer:coarse)").matches;m.isMobile=Jr;const Qr=e=>e.map(r=>{if(r.type!=="FunctionCall")return r;let{args:t,deposit:n,gas:o,methodName:i}=r.params;return ArrayBuffer.isView(t)&&(t=M.from(t.buffer,t.byteOffset,t.byteLength)),t instanceof M&&(t=t.toString("base64")),{type:r.type,params:{args:t,deposit:n,gas:o,methodName:i}}});m.serializeActions=Qr;const Zr=(e,r)=>qr(void 0,void 0,void 0,function*(){const t=yield fetch(e,{method:"POST",body:JSON.stringify({jsonrpc:"2.0",id:"dontcare",method:"query",params:{request_type:"view_access_key_list",finality:"final",account_id:r}}),headers:{"content-type":"application/json"}});return t.ok===!1?[]:(yield t.json()).result.keys});m.getPublicKeys=Zr;const Xr=(e,r)=>{var t,n,o;if(e instanceof st.HereProviderError)throw e;const i={payload:e instanceof Error?e.message:"UNKNOWN",status:st.HereProviderStatus.FAILED,account_id:""};throw(t=r.onFailed)===null||t===void 0||t.call(r,i),(o=(n=r==null?void 0:r.strategy)===null||n===void 0?void 0:n.onFailed)===null||o===void 0||o.call(n,i),e};m.internalThrow=Xr;const en=(e,r,t)=>{const{permission:n}=r.access_key;if(n==="FullAccess")return!0;if(n.FunctionCall){const{receiver_id:o,method_names:i}=n.FunctionCall;if(o===e&&i.includes("add_request_and_confirm"))return!0;if(o===t.receiverId)return t.actions.length!==1?!1:t.actions.every(c=>c.type!=="FunctionCall"?!1:(!c.params.deposit||c.params.deposit.toString()==="0")&&(i.length===0||i.includes(c.params.methodName)))}return!1};m.isValidAccessKey=en;var qe={},Gt={},Vt={exports:{}},Yt={exports:{}};(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return r.rotl(t,8)&16711935|r.rotl(t,24)&4278255360;for(var n=0;n<t.length;n++)t[n]=r.endian(t[n]);return t},randomBytes:function(t){for(var n=[];t>0;t--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(t){for(var n=[],o=0,i=0;o<t.length;o++,i+=8)n[i>>>5]|=t[o]<<24-i%32;return n},wordsToBytes:function(t){for(var n=[],o=0;o<t.length*32;o+=8)n.push(t[o>>>5]>>>24-o%32&255);return n},bytesToHex:function(t){for(var n=[],o=0;o<t.length;o++)n.push((t[o]>>>4).toString(16)),n.push((t[o]&15).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],o=0;o<t.length;o+=2)n.push(parseInt(t.substr(o,2),16));return n},bytesToBase64:function(t){for(var n=[],o=0;o<t.length;o+=3)for(var i=t[o]<<16|t[o+1]<<8|t[o+2],c=0;c<4;c++)o*8+c*6<=t.length*8?n.push(e.charAt(i>>>6*(3-c)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],o=0,i=0;o<t.length;i=++o%4)i!=0&&n.push((e.indexOf(t.charAt(o-1))&Math.pow(2,-2*i+8)-1)<<i*2|e.indexOf(t.charAt(o))>>>6-i*2);return n}};Yt.exports=r})();var tn=Yt.exports,ke={utf8:{stringToBytes:function(e){return ke.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(ke.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var r=[],t=0;t<e.length;t++)r.push(e.charCodeAt(t)&255);return r},bytesToString:function(e){for(var r=[],t=0;t<e.length;t++)r.push(String.fromCharCode(e[t]));return r.join("")}}},lt=ke;(function(){var e=tn,r=lt.utf8,t=lt.bin,n=function(i){i.constructor==String?i=r.stringToBytes(i):typeof M<"u"&&typeof M.isBuffer=="function"&&M.isBuffer(i)?i=Array.prototype.slice.call(i,0):Array.isArray(i)||(i=i.toString());var c=e.bytesToWords(i),s=i.length*8,u=[],d=1732584193,a=-271733879,l=-1732584194,v=271733878,f=-1009589776;c[s>>5]|=128<<24-s%32,c[(s+64>>>9<<4)+15]=s;for(var y=0;y<c.length;y+=16){for(var h=d,g=a,b=l,I=v,j=f,w=0;w<80;w++){if(w<16)u[w]=c[y+w];else{var $=u[w-3]^u[w-8]^u[w-14]^u[w-16];u[w]=$<<1|$>>>31}var D=(d<<5|d>>>27)+f+(u[w]>>>0)+(w<20?(a&l|~a&v)+1518500249:w<40?(a^l^v)+1859775393:w<60?(a&l|a&v|l&v)-1894007588:(a^l^v)-899497514);f=v,v=l,l=a<<30|a>>>2,a=d,d=D}d+=h,a+=g,l+=b,v+=I,f+=j}return[d,a,l,v,f]},o=function(i,c){var s=e.wordsToBytes(n(i));return c&&c.asBytes?s:c&&c.asString?t.bytesToString(s):e.bytesToHex(s)};o._blocksize=16,o._digestsize=20,Vt.exports=o})();var rn=Vt.exports;(function(e){var r=p&&p.__awaiter||function(l,v,f,y){function h(g){return g instanceof f?g:new f(function(b){b(g)})}return new(f||(f=Promise))(function(g,b){function I($){try{w(y.next($))}catch(D){b(D)}}function j($){try{w(y.throw($))}catch(D){b(D)}}function w($){$.done?g($.value):h($.value).then(I,j)}w((y=y.apply(l,v||[])).next())})},t=p&&p.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0}),e.createRequest=e.deleteRequest=e.getResponse=e.getRequest=e.proxyApi=void 0;const n=t(rn),o=t(qt),i=Kr,c=m;e.proxyApi="https://h4n.app";const s=(l,v)=>r(void 0,void 0,void 0,function*(){const f=yield fetch(`${e.proxyApi}/${l}/request`,{signal:v,headers:{"content-type":"application/json"},method:"GET"});if(f.ok===!1)throw Error(yield f.text());const{data:y}=yield f.json();return JSON.parse((0,i.base_decode)(y).toString("utf8"))});e.getRequest=s;const u=l=>r(void 0,void 0,void 0,function*(){var v,f,y,h;const g=yield fetch(`${e.proxyApi}/${l}/response`,{headers:{"content-type":"application/json"},method:"GET"});if(g.ok===!1)throw Error(yield g.text());const{data:b}=yield g.json(),I=(v=JSON.parse(b))!==null&&v!==void 0?v:{};return{account_id:(f=I.account_id)!==null&&f!==void 0?f:"",payload:(y=I.payload)!==null&&y!==void 0?y:"",status:(h=I.status)!==null&&h!==void 0?h:-1,topic:I.topic}});e.getResponse=u;const d=l=>r(void 0,void 0,void 0,function*(){const v=yield fetch(`${e.proxyApi}/${l}`,{headers:{"content-type":"application/json"},method:"DELETE"});if(v.ok===!1)throw Error(yield v.text())});e.deleteRequest=d;const a=(l,v)=>r(void 0,void 0,void 0,function*(){const f=(0,i.base_encode)(JSON.stringify(Object.assign(Object.assign({},l),{_id:(0,o.default)()}))),y=(0,n.default)(f),g=M.from(y,"hex").toString("base64").replaceAll("/","_").replaceAll("-","+").slice(0,13),b=yield fetch(`${e.proxyApi}/${g}/request`,{method:"POST",signal:v,body:JSON.stringify({topic_id:(0,c.getDeviceId)(),data:f}),headers:{"content-type":"application/json"}});if(b.ok===!1)throw Error(yield b.text());return g});e.createRequest=a})(Gt);(function(e){var r=p&&p.__awaiter||function(s,u,d,a){function l(v){return v instanceof d?v:new d(function(f){f(v)})}return new(d||(d=Promise))(function(v,f){function y(b){try{g(a.next(b))}catch(I){f(I)}}function h(b){try{g(a.throw(b))}catch(I){f(I)}}function g(b){b.done?v(b.value):l(b.value).then(y,h)}g((a=a.apply(s,u||[])).next())})},t=p&&p.__rest||function(s,u){var d={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&u.indexOf(a)<0&&(d[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(s);l<a.length;l++)u.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(s,a[l])&&(d[a[l]]=s[a[l]]);return d};Object.defineProperty(e,"__esModule",{value:!0}),e.proxyProvider=e.getRequest=e.proxyApi=e.deleteRequest=e.getResponse=e.createRequest=void 0;const n=m,o=Z,i=Gt;Object.defineProperty(e,"createRequest",{enumerable:!0,get:function(){return i.createRequest}}),Object.defineProperty(e,"getResponse",{enumerable:!0,get:function(){return i.getResponse}}),Object.defineProperty(e,"deleteRequest",{enumerable:!0,get:function(){return i.deleteRequest}}),Object.defineProperty(e,"proxyApi",{enumerable:!0,get:function(){return i.proxyApi}}),Object.defineProperty(e,"getRequest",{enumerable:!0,get:function(){return i.getRequest}});const c=s=>r(void 0,void 0,void 0,function*(){let{strategy:u,request:d,disableCleanupRequest:a,id:l,signal:v}=s,f=t(s,["strategy","request","disableCleanupRequest","id","signal"]);return l!=null?d=yield(0,i.getRequest)(l,v):l=yield(0,i.createRequest)(d,v),new Promise((y,h)=>{var g,b;const I=i.proxyApi.replace("https","wss");let j=null,w=null;const $=()=>r(void 0,void 0,void 0,function*(){j=-1,clearInterval(j),w==null||w.close(),a!==!0&&(yield(0,i.deleteRequest)(l))}),D=S=>{var T,A,W,F,H,we;switch(S.status){case o.HereProviderStatus.APPROVING:(T=f.onApproving)===null||T===void 0||T.call(f,S),(A=u==null?void 0:u.onApproving)===null||A===void 0||A.call(u,S);return;case o.HereProviderStatus.FAILED:$(),h(new o.HereProviderError(S.payload)),(W=f.onFailed)===null||W===void 0||W.call(f,S),(F=u==null?void 0:u.onFailed)===null||F===void 0||F.call(u,S);return;case o.HereProviderStatus.SUCCESS:$(),y(S),(H=f.onSuccess)===null||H===void 0||H.call(f,S),(we=u==null?void 0:u.onSuccess)===null||we===void 0||we.call(u,S);return}},be=S=>{D({status:o.HereProviderStatus.FAILED,payload:S})};(g=f.onRequested)===null||g===void 0||g.call(f,l,d,be),(b=u==null?void 0:u.onRequested)===null||b===void 0||b.call(u,l,d,be),v==null||v.addEventListener("abort",()=>be());const at=()=>{j!==-1&&(j=setTimeout(()=>r(void 0,void 0,void 0,function*(){var S,T;try{const A=yield(0,i.getResponse)(l);if(j===-1)return;D(A),at()}catch(A){const W=o.HereProviderStatus.FAILED,F=A instanceof Error?A:void 0,H=F==null?void 0:F.message;$(),h(new o.HereProviderError(H,F)),(S=f.onFailed)===null||S===void 0||S.call(f,{status:W,payload:H}),(T=u==null?void 0:u.onFailed)===null||T===void 0||T.call(u,{status:W,payload:H})}}),3e3))};if(at(),(0,n.isMobile)()===!1){const S=`${I}/ws/${l}`;w=new WebSocket(S),w.onmessage=T=>{if(T.data!=null)try{const A=JSON.parse(T.data);D(A)}catch{}}}})});e.proxyProvider=c})(qe);var Ge={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createAction=e.parseArgs=void 0;const r=Ht,t=zt,n=c=>{if(c==="FullAccess")return t.transactions.fullAccessKey();const{receiverId:s,methodNames:u=[]}=c,d=c.allowance?new r.BN(c.allowance):void 0;return t.transactions.functionCallAccessKey(s,u,d)},o=c=>typeof c=="string"?M.from(c,"base64"):c;e.parseArgs=o;const i=c=>{switch(c.type){case"CreateAccount":return t.transactions.createAccount();case"DeployContract":{const{code:s}=c.params;return t.transactions.deployContract(s)}case"FunctionCall":{const{methodName:s,args:u,gas:d,deposit:a}=c.params;return t.transactions.functionCall(s,(0,e.parseArgs)(u),new r.BN(d),new r.BN(a))}case"Transfer":{const{deposit:s}=c.params;return t.transactions.transfer(new r.BN(s))}case"Stake":{const{stake:s,publicKey:u}=c.params;return t.transactions.stake(new r.BN(s),t.utils.PublicKey.from(u))}case"AddKey":{const{publicKey:s,accessKey:u}=c.params;return t.transactions.addKey(t.utils.PublicKey.from(s),n(u.permission))}case"DeleteKey":{const{publicKey:s}=c.params;return t.transactions.deleteKey(t.utils.PublicKey.from(s))}case"DeleteAccount":{const{beneficiaryId:s}=c.params;return t.transactions.deleteAccount(s)}default:throw new Error("Invalid action type")}};e.createAction=i})(Ge);var Ve={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WidgetStrategy=e.defaultUrl=void 0;const r=n=>{const o=document.createElement("iframe");return o.src=n,o.style.border="none",o.style.zIndex="10000",o.style.position="fixed",o.style.display="none",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",document.body.appendChild(o),o};e.defaultUrl="https://my.herewallet.app/connector/index.html";class t{constructor(o={widget:e.defaultUrl,lazy:!1}){this.options={lazy:typeof o=="object"&&o.lazy||!1,widget:typeof o=="string"?o:o.widget||e.defaultUrl},this.options.lazy||this.initIframe()}initIframe(){return t.connector==null&&(t.connector=r(this.options.widget),t.connector.addEventListener("load",()=>{t.isLoaded=!0})),t.connector}onRequested(o,i,c){const s=this.initIframe();s.style.display="block";const u=()=>{var d,a,l;(d=t.connector)===null||d===void 0||d.removeEventListener("load",u),(l=(a=t.connector)===null||a===void 0?void 0:a.contentWindow)===null||l===void 0||l.postMessage(JSON.stringify({type:"request",payload:{id:o,request:i}}),new URL(this.options.widget).origin)};t.isLoaded?u():s.addEventListener("load",u),this.messageHandler=d=>{try{if(d.origin!==new URL(this.options.widget).origin)return;JSON.parse(d.data).type==="reject"&&c()}catch{}},window.addEventListener("message",this.messageHandler)}postMessage(o){var i;const c=this.initIframe(),s=JSON.stringify(o),u=new URL(this.options.widget).origin;(i=c.contentWindow)===null||i===void 0||i.postMessage(s,u)}onApproving(){this.postMessage({type:"approving"})}onSuccess(o){console.log(o),this.postMessage({type:"result",payload:{request:o}}),this.close()}onFailed(o){this.postMessage({type:"result",payload:{request:o}}),this.close()}close(){this.messageHandler&&(window.removeEventListener("message",this.messageHandler),this.messageHandler=void 0),t.connector&&(t.connector.style.display="none")}}e.WidgetStrategy=t,t.isLoaded=!1})(Ve);var Jt={};(function(e){var r=p&&p.__createBinding||(Object.create?function(a,l,v,f){f===void 0&&(f=v),Object.defineProperty(a,f,{enumerable:!0,get:function(){return l[v]}})}:function(a,l,v,f){f===void 0&&(f=v),a[f]=l[v]}),t=p&&p.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),n=p&&p.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var v in a)v!=="default"&&Object.prototype.hasOwnProperty.call(a,v)&&r(l,a,v);return t(l,a),l},o=p&&p.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.verifySignature=e.authPayloadSchema=e.AuthPayload=void 0;const i=n(Fr),c=o(Ut),s=Cr;class u{constructor({message:l,nonce:v,recipient:f,callbackUrl:y}){this.tag=2147484061,this.message=l,this.nonce=v,this.recipient=f,y&&(this.callbackUrl=y)}}e.AuthPayload=u,e.authPayloadSchema=new Map([[u,{kind:"struct",fields:[["tag","u32"],["message","string"],["nonce",[32]],["recipient","string"],["callbackUrl",{kind:"option",type:"string"}]]}]]);function d(a,l){const v=new u(a),f=i.serialize(e.authPayloadSchema,v),y=Uint8Array.from(c.default.sha256.array(f));let h=new Uint8Array(M.from(l.signature,"base64"));return s.PublicKey.from(l.publicKey).verify(y,h)}e.verifySignature=d})(Jt);var _=p&&p.__awaiter||function(e,r,t,n){function o(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function s(a){try{d(n.next(a))}catch(l){c(l)}}function u(a){try{d(n.throw(a))}catch(l){c(l)}}function d(a){a.done?i(a.value):o(a.value).then(s,u)}d((n=n.apply(e,r||[])).next())})},ne=p&&p.__rest||function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(t[n[o]]=e[n[o]]);return t},nn=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ye,"__esModule",{value:!0});ye.HereWallet=void 0;const oe=zt,on=kr,Se=Bt,an=Ut,cn=Lr(),me=nn(Ht),sn=J,ut=Z,L=m,ln=qe,un=Ge,dn=Ve,vn=Jt;class z extends Error{}class fn{constructor({nodeUrl:r,networkId:t="mainnet",authStorage:n=new sn.HereKeyStore,defaultStrategy:o=()=>new dn.WidgetStrategy,defaultProvider:i=ln.proxyProvider}={}){this.authStorage=n,this.defaultProvider=i,this.defaultStrategy=o;const c=new oe.InMemorySigner(this.authStorage),s=new on.JsonRpcProvider({url:r??`https://rpc.${t}.near.org`});this.connection=oe.Connection.fromConfig({jsvmAccountId:`jsvm.${t}`,provider:s,networkId:t,signer:c})}get rpc(){return this.connection.provider}get signer(){return this.connection.signer}get networkId(){return this.connection.networkId}account(r){return _(this,void 0,void 0,function*(){const t=r??(yield this.authStorage.getActiveAccount(this.networkId));if(t==null)throw new z("Wallet not signed in");return new oe.Account(this.connection,t)})}isSignedIn(){return _(this,void 0,void 0,function*(){return(yield this.authStorage.getActiveAccount(this.networkId))!=null})}signOut(){return _(this,void 0,void 0,function*(){const r=yield this.authStorage.getActiveAccount(this.networkId);if(r==null)throw new z("Wallet not signed in");const t=yield this.authStorage.getKey(this.networkId,r);if(t!=null){const n=t.getPublicKey().toString();yield this.silentSignAndSendTransaction({receiverId:r,actions:[{type:"DeleteKey",params:{publicKey:n}}]}).catch(()=>{})}yield this.authStorage.removeKey(this.networkId,r)})}getHereBalance(r){return _(this,void 0,void 0,function*(){const t=yield this.account(r),n=this.networkId==="mainnet"?"here.storage.near":"here.storage.testnet",o=yield t.viewFunction({args:{account_id:t.accountId},methodName:"ft_balance_of",contractId:n}).catch(()=>"0");return new me.default(o)})}getAvailableBalance(r){return _(this,void 0,void 0,function*(){const n=yield(yield this.account(r)).getAccountBalance(),o=yield this.getHereBalance();return new me.default(n.available).add(new me.default(o))})}getAccounts(){return _(this,void 0,void 0,function*(){return yield this.authStorage.getAccounts(this.networkId)})}getAccountId(){return _(this,void 0,void 0,function*(){const r=yield this.authStorage.getActiveAccount(this.networkId);if(r==null)throw new z("Wallet not signed in");return r})}switchAccount(r){return _(this,void 0,void 0,function*(){if((yield this.authStorage.getKey(this.networkId,r))==null)throw new Error(`Account ${r} not signed in`);yield this.authStorage.setActiveAccount(this.networkId,r)})}signIn(r={}){var t,n,o,i,c,{contractId:s,allowance:u,methodNames:d=[]}=r,a=ne(r,["contractId","allowance","methodNames"]);return _(this,void 0,void 0,function*(){if(s==null){const{accountId:l}=yield this.authenticate(a);return yield this.authStorage.setKey(this.networkId,l,Se.KeyPairEd25519.fromRandom()),yield this.authStorage.setActiveAccount(this.networkId,l),l}a.strategy=(t=a.strategy)!==null&&t!==void 0?t:this.defaultStrategy(),a.provider=(n=a.provider)!==null&&n!==void 0?n:this.defaultProvider,(o=a.onInitialized)===null||o===void 0||o.call(a),(c=(i=a.strategy)===null||i===void 0?void 0:i.onInitialized)===null||c===void 0||c.call(i);try{const l=oe.KeyPair.fromRandom("ed25519"),v={receiverId:s,methodNames:d,allowance:u},f=yield a.provider(Object.assign(Object.assign({},a),{request:{type:"call",network:this.networkId,transactions:[{actions:[{type:"AddKey",params:{publicKey:l.getPublicKey().toString(),accessKey:{permission:v}}}]}]}}));if(f.account_id==null)throw Error("Transaction is failed");return yield this.authStorage.setKey(this.networkId,f.account_id,l),yield this.authStorage.setActiveAccount(this.networkId,f.account_id),f.account_id}catch(l){throw(0,L.internalThrow)(l,a),l}})}silentSignAndSendTransaction({actions:r,receiverId:t,signerId:n}){return _(this,void 0,void 0,function*(){const o=yield this.account(n),i=yield this.authStorage.getKey(this.networkId,o.accountId);if(i==null)throw new z;const c=i.getPublicKey(),s=yield o.getAccessKeys(),u={receiverId:t,actions:r};if(s.some(a=>a.public_key!==c.toString()?!1:(0,L.isValidAccessKey)(o.accountId,a,u))===!1)throw new z;return yield o.signAndSendTransaction({actions:r.map(a=>(0,un.createAction)(a)),receiverId:t??o.accountId})})}signAndSendTransaction(r){var t,n,o,i,c,s,u,d;return _(this,void 0,void 0,function*(){const{signerId:a,receiverId:l,actions:v}=r,y=ne(r,["signerId","receiverId","actions"]);y.strategy=(t=y.strategy)!==null&&t!==void 0?t:this.defaultStrategy(),y.provider=(n=y.provider)!==null&&n!==void 0?n:this.defaultProvider,(o=y.onInitialized)===null||o===void 0||o.call(y),(c=(i=y.strategy)===null||i===void 0?void 0:i.onInitialized)===null||c===void 0||c.call(i);try{const h=yield this.silentSignAndSendTransaction({receiverId:l,actions:v,signerId:a}),g={status:ut.HereProviderStatus.SUCCESS,payload:h==null?void 0:h.transaction_outcome.id};return(s=y.onSuccess)===null||s===void 0||s.call(y,g),(d=(u=y.strategy)===null||u===void 0?void 0:u.onSuccess)===null||d===void 0||d.call(u,g),h}catch(h){try{if(!(h instanceof z)&&(h==null?void 0:h.type)!=="NotEnoughAllowance")throw(0,L.internalThrow)(h,y),h;const g=yield y.provider(Object.assign(Object.assign({},y),{request:{type:"call",transactions:[{actions:(0,L.serializeActions)(v),receiverId:l,signerId:a}],network:this.networkId}}));if(g.payload==null||g.account_id==null)throw Error("Transaction not found, but maybe executed");return yield this.rpc.txStatus(g.payload,g.account_id)}catch(g){throw(0,L.internalThrow)(g,y),g}}})}verifyMessageNEP0413(r,t){return _(this,void 0,void 0,function*(){if(!(0,vn.verifySignature)(r,t))throw Error("Incorrect signature");if(!(yield(yield this.account(t.accountId)).getAccessKeys()).some(s=>!(s.public_key!==t.publicKey||s.access_key.permission!=="FullAccess")))throw Error("Signer public key is not full access");return!0})}authenticate(r={}){var t,n,o;return _(this,void 0,void 0,function*(){const i={nonce:(t=r.nonce)!==null&&t!==void 0?t:(0,cn.randomBytes)(32),recipient:(n=r.recipient)!==null&&n!==void 0?n:window.location.host,message:(o=r.message)!==null&&o!==void 0?o:"Authenticate"},c=yield this.signMessage(Object.assign(Object.assign({},i),r));return yield this.verifyMessageNEP0413(i,c),c})}signMessage(r){var t,n,o,i,c;return _(this,void 0,void 0,function*(){if(r.strategy=(t=r.strategy)!==null&&t!==void 0?t:this.defaultStrategy(),r.provider=(n=r.provider)!==null&&n!==void 0?n:this.defaultProvider,(o=r.onInitialized)===null||o===void 0||o.call(r),(c=(i=r.strategy)===null||i===void 0?void 0:i.onInitialized)===null||c===void 0||c.call(i),"receiver"in r)return yield this.legacySignMessage(r);const s=yield r.provider(Object.assign(Object.assign({},r),{request:{type:"sign",message:r.message,recipient:r.recipient,nonce:Array.from(r.nonce),network:this.networkId}}));if((s==null?void 0:s.payload)==null)throw Error("Signature not found");const{publicKey:u,signature:d,accountId:a}=JSON.parse(s.payload);return{publicKey:u,signature:d,accountId:a}})}legacySignMessage(r){var t,{message:n,receiver:o,nonce:i}=r,c=ne(r,["message","receiver","nonce"]);return _(this,void 0,void 0,function*(){if(i==null){let u=new Uint8Array(32);i=[...crypto.getRandomValues(u)]}const s=yield(t=c.provider)===null||t===void 0?void 0:t.call(c,Object.assign(Object.assign({},c),{request:{type:"sign",message:n,receiver:o,nonce:i,network:this.networkId}}));if((s==null?void 0:s.payload)==null)throw Error("Signature not found");try{const{publicKey:u,signature:d,accountId:a}=JSON.parse(s.payload),l=new Uint8Array(M.from(d,"base64")),v=JSON.stringify({message:n,receiver:o,nonce:i}),f=new Uint8Array(an.sha256.digest("NEP0413:"+v));if(Se.PublicKey.from(u).verify(f,l)===!1)throw Error();const g=yield(yield this.account(a)).getAccessKeys(),b=u.toString();if(g.some(j=>!(j.public_key!==b||j.access_key.permission!=="FullAccess"))===!1)throw Error();return{signature:new Uint8Array(M.from(d,"base64")),publicKey:Se.PublicKey.from(u),message:"NEP0413:"+v,receiver:o,accountId:a,nonce:i}}catch{throw Error("Signature not correct")}})}signAndSendTransactions(r){var t,n,o,i,c,s,u,d,{transactions:a}=r,l=ne(r,["transactions"]);return _(this,void 0,void 0,function*(){l.strategy=(t=l.strategy)!==null&&t!==void 0?t:this.defaultStrategy(),l.provider=(n=l.provider)!==null&&n!==void 0?n:this.defaultProvider,(o=l.onInitialized)===null||o===void 0||o.call(l),(c=(i=l.strategy)===null||i===void 0?void 0:i.onInitialized)===null||c===void 0||c.call(i);let v=[];try{for(const h of a){const g=yield this.silentSignAndSendTransaction(h);v.push(g)}const f=v.map(h=>h.transaction_outcome.id).join(","),y={status:ut.HereProviderStatus.SUCCESS,payload:f};return(s=l.onSuccess)===null||s===void 0||s.call(l,y),(d=(u=l.strategy)===null||u===void 0?void 0:u.onSuccess)===null||d===void 0||d.call(u,y),v}catch(f){try{if(!(f instanceof z)&&(f==null?void 0:f.type)!=="NotEnoughAllowance")throw(0,L.internalThrow)(f,l),f;const y=a.slice(v.length),h=yield l.provider(Object.assign(Object.assign({},l),{request:{type:"call",transactions:y.map(b=>Object.assign(Object.assign({},b),{actions:(0,L.serializeActions)(b.actions)})),network:this.networkId}}));if(h.payload==null||h.account_id==null)throw Error("Transaction not found, but maybe executed");const g=h.payload.split(",").map(b=>this.rpc.txStatus(b,h.account_id));return yield Promise.all(g)}catch(y){throw(0,L.internalThrow)(y,l),y}}})}}ye.HereWallet=fn;var Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});var ge={};Object.defineProperty(ge,"__esModule",{value:!0});ge.WindowStrategy=void 0;class yn{constructor(r="https://my.herewallet.app"){this.endpoint=r,this.signWindow=null,this.onFailed=()=>this.close(),this.onSuccess=()=>this.close()}onInitialized(){if(this.signWindow)return;const r=window.innerWidth/2-420/2,t=window.innerHeight/2-700/2;this.signWindow=window.open(`${this.endpoint}/loading`,"_blank",`popup=1,width=420,height=700,top=${t},left=${r}`)}onRequested(r,t,n){this.signWindow!=null&&(this.unloadHandler=()=>{var o;return(o=this.signWindow)===null||o===void 0?void 0:o.close()},window.addEventListener("beforeunload",this.unloadHandler),this.signWindow.location=`${this.endpoint}/request/${r}`,this.timerHandler=setInterval(()=>{var o;!((o=this.signWindow)===null||o===void 0)&&o.closed&&n("CLOSED")},1e3))}close(){var r;clearInterval(this.timerHandler),(r=this.signWindow)===null||r===void 0||r.close(),this.signWindow=null,this.unloadHandler&&window.removeEventListener("beforeunload",this.unloadHandler)}}ge.WindowStrategy=yn;var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});(function(e){var r=p&&p.__createBinding||(Object.create?function(o,i,c,s){s===void 0&&(s=c),Object.defineProperty(o,s,{enumerable:!0,get:function(){return i[c]}})}:function(o,i,c,s){s===void 0&&(s=c),o[s]=i[c]}),t=p&&p.__exportStar||function(o,i){for(var c in o)c!=="default"&&!Object.prototype.hasOwnProperty.call(i,c)&&r(i,o,c)};Object.defineProperty(e,"__esModule",{value:!0}),e.HereWallet=void 0;var n=ye;Object.defineProperty(e,"HereWallet",{enumerable:!0,get:function(){return n.HereWallet}}),t(Ge,e),t(J,e),t(Q,e),t(Qt,e),t(Ve,e),t(ge,e),t(Z,e),t(Zt,e),t(m,e),t(qe,e)})(xt);var dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ct<"u"?ct:typeof self<"u"?self:{},ie=function(e){return e&&e.Math==Math&&e},K=ie(typeof globalThis=="object"&&globalThis)||ie(typeof window=="object"&&window)||ie(typeof self=="object"&&self)||ie(typeof dt=="object"&&dt)||function(){return this}()||Function("return this")(),Ye={},N=function(e){try{return!!e()}catch{return!0}},gn=N,k=!gn(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),hn=N,Xt=!hn(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),pn=Xt,ae=Function.prototype.call,X=pn?ae.bind(ae):function(){return ae.apply(ae,arguments)},Je={},er={}.propertyIsEnumerable,tr=Object.getOwnPropertyDescriptor,bn=tr&&!er.call({1:2},1);Je.f=bn?function(r){var t=tr(this,r);return!!t&&t.enumerable}:er;var rr=function(e,r){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:r}},nr=Xt,or=Function.prototype,wn=or.bind,Be=or.call,Sn=nr&&wn.bind(Be,Be),R=nr?function(e){return e&&Sn(e)}:function(e){return e&&function(){return Be.apply(e,arguments)}},ir=R,mn=ir({}.toString),_n=ir("".slice),ar=function(e){return _n(mn(e),8,-1)},On=R,In=N,$n=ar,_e=Object,jn=On("".split),cr=In(function(){return!_e("z").propertyIsEnumerable(0)})?function(e){return $n(e)=="String"?jn(e,""):_e(e)}:_e,An=TypeError,sr=function(e){if(e==null)throw An("Can't call method on "+e);return e},En=cr,Pn=sr,Qe=function(e){return En(Pn(e))},P=function(e){return typeof e=="function"},Tn=P,ee=function(e){return typeof e=="object"?e!==null:Tn(e)},Oe=K,Mn=P,Nn=function(e){return Mn(e)?e:void 0},Ze=function(e,r){return arguments.length<2?Nn(Oe[e]):Oe[e]&&Oe[e][r]},Rn=R,lr=Rn({}.isPrototypeOf),Dn=Ze,Kn=Dn("navigator","userAgent")||"",ur=K,Ie=Kn,vt=ur.process,ft=ur.Deno,yt=vt&&vt.versions||ft&&ft.version,gt=yt&&yt.v8,E,de;gt&&(E=gt.split("."),de=E[0]>0&&E[0]<4?1:+(E[0]+E[1]));!de&&Ie&&(E=Ie.match(/Edge\/(\d+)/),(!E||E[1]>=74)&&(E=Ie.match(/Chrome\/(\d+)/),E&&(de=+E[1])));var Fn=de,ht=Fn,Cn=N,dr=!!Object.getOwnPropertySymbols&&!Cn(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ht&&ht<41}),Ln=dr,vr=Ln&&!Symbol.sham&&typeof Symbol.iterator=="symbol",kn=Ze,Bn=P,Hn=lr,zn=vr,Un=Object,fr=zn?function(e){return typeof e=="symbol"}:function(e){var r=kn("Symbol");return Bn(r)&&Hn(r.prototype,Un(e))},xn=String,Wn=function(e){try{return xn(e)}catch{return"Object"}},qn=P,Gn=Wn,Vn=TypeError,Yn=function(e){if(qn(e))return e;throw Vn(Gn(e)+" is not a function")},Jn=Yn,Qn=function(e,r){var t=e[r];return t==null?void 0:Jn(t)},$e=X,je=P,Ae=ee,Zn=TypeError,Xn=function(e,r){var t,n;if(r==="string"&&je(t=e.toString)&&!Ae(n=$e(t,e))||je(t=e.valueOf)&&!Ae(n=$e(t,e))||r!=="string"&&je(t=e.toString)&&!Ae(n=$e(t,e)))return n;throw Zn("Can't convert object to primitive value")},Xe={exports:{}},pt=K,eo=Object.defineProperty,et=function(e,r){try{eo(pt,e,{value:r,configurable:!0,writable:!0})}catch{pt[e]=r}return r},to=K,ro=et,bt="__core-js_shared__",no=to[bt]||ro(bt,{}),tt=no,wt=tt;(Xe.exports=function(e,r){return wt[e]||(wt[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.23.3",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"});var oo=sr,io=Object,yr=function(e){return io(oo(e))},ao=R,co=yr,so=ao({}.hasOwnProperty),B=Object.hasOwn||function(r,t){return so(co(r),t)},lo=R,uo=0,vo=Math.random(),fo=lo(1 .toString),gr=function(e){return"Symbol("+(e===void 0?"":e)+")_"+fo(++uo+vo,36)},yo=K,go=Xe.exports,St=B,ho=gr,mt=dr,hr=vr,q=go("wks"),x=yo.Symbol,_t=x&&x.for,po=hr?x:x&&x.withoutSetter||ho,rt=function(e){if(!St(q,e)||!(mt||typeof q[e]=="string")){var r="Symbol."+e;mt&&St(x,e)?q[e]=x[e]:hr&&_t?q[e]=_t(r):q[e]=po(r)}return q[e]},bo=X,Ot=ee,It=fr,wo=Qn,So=Xn,mo=rt,_o=TypeError,Oo=mo("toPrimitive"),Io=function(e,r){if(!Ot(e)||It(e))return e;var t=wo(e,Oo),n;if(t){if(r===void 0&&(r="default"),n=bo(t,e,r),!Ot(n)||It(n))return n;throw _o("Can't convert object to primitive value")}return r===void 0&&(r="number"),So(e,r)},$o=Io,jo=fr,pr=function(e){var r=$o(e,"string");return jo(r)?r:r+""},Ao=K,$t=ee,He=Ao.document,Eo=$t(He)&&$t(He.createElement),Po=function(e){return Eo?He.createElement(e):{}},To=k,Mo=N,No=Po,br=!To&&!Mo(function(){return Object.defineProperty(No("div"),"a",{get:function(){return 7}}).a!=7}),Ro=k,Do=X,Ko=Je,Fo=rr,Co=Qe,Lo=pr,ko=B,Bo=br,jt=Object.getOwnPropertyDescriptor;Ye.f=Ro?jt:function(r,t){if(r=Co(r),t=Lo(t),Bo)try{return jt(r,t)}catch{}if(ko(r,t))return Fo(!Do(Ko.f,r,t),r[t])};var he={},Ho=k,zo=N,Uo=Ho&&zo(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),xo=ee,Wo=String,qo=TypeError,pe=function(e){if(xo(e))return e;throw qo(Wo(e)+" is not an object")},Go=k,Vo=br,Yo=Uo,ce=pe,At=pr,Jo=TypeError,Ee=Object.defineProperty,Qo=Object.getOwnPropertyDescriptor,Pe="enumerable",Te="configurable",Me="writable";he.f=Go?Yo?function(r,t,n){if(ce(r),t=At(t),ce(n),typeof r=="function"&&t==="prototype"&&"value"in n&&Me in n&&!n[Me]){var o=Qo(r,t);o&&o[Me]&&(r[t]=n.value,n={configurable:Te in n?n[Te]:o[Te],enumerable:Pe in n?n[Pe]:o[Pe],writable:!1})}return Ee(r,t,n)}:Ee:function(r,t,n){if(ce(r),t=At(t),ce(n),Vo)try{return Ee(r,t,n)}catch{}if("get"in n||"set"in n)throw Jo("Accessors not supported");return"value"in n&&(r[t]=n.value),r};var Zo=k,Xo=he,ei=rr,wr=Zo?function(e,r,t){return Xo.f(e,r,ei(1,t))}:function(e,r,t){return e[r]=t,e},Sr={exports:{}},ze=k,ti=B,mr=Function.prototype,ri=ze&&Object.getOwnPropertyDescriptor,nt=ti(mr,"name"),ni=nt&&(function(){}).name==="something",oi=nt&&(!ze||ze&&ri(mr,"name").configurable),_r={EXISTS:nt,PROPER:ni,CONFIGURABLE:oi},ii=R,ai=P,Ue=tt,ci=ii(Function.toString);ai(Ue.inspectSource)||(Ue.inspectSource=function(e){return ci(e)});var Or=Ue.inspectSource,si=K,li=P,ui=Or,Et=si.WeakMap,di=li(Et)&&/native code/.test(ui(Et)),vi=Xe.exports,fi=gr,Pt=vi("keys"),yi=function(e){return Pt[e]||(Pt[e]=fi(e))},Ir={},gi=di,$r=K,Ne=R,hi=ee,pi=wr,Re=B,De=tt,bi=yi,wi=Ir,Tt="Object already initialized",xe=$r.TypeError,Si=$r.WeakMap,ve,Y,fe,mi=function(e){return fe(e)?Y(e):ve(e,{})},_i=function(e){return function(r){var t;if(!hi(r)||(t=Y(r)).type!==e)throw xe("Incompatible receiver, "+e+" required");return t}};if(gi||De.state){var U=De.state||(De.state=new Si),Oi=Ne(U.get),Mt=Ne(U.has),Ii=Ne(U.set);ve=function(e,r){if(Mt(U,e))throw new xe(Tt);return r.facade=e,Ii(U,e,r),r},Y=function(e){return Oi(U,e)||{}},fe=function(e){return Mt(U,e)}}else{var G=bi("state");wi[G]=!0,ve=function(e,r){if(Re(e,G))throw new xe(Tt);return r.facade=e,pi(e,G,r),r},Y=function(e){return Re(e,G)?e[G]:{}},fe=function(e){return Re(e,G)}}var $i={set:ve,get:Y,has:fe,enforce:mi,getterFor:_i},ji=N,Ai=P,se=B,We=k,Ei=_r.CONFIGURABLE,Pi=Or,jr=$i,Ti=jr.enforce,Mi=jr.get,le=Object.defineProperty,Ni=We&&!ji(function(){return le(function(){},"length",{value:8}).length!==8}),Ri=String(String).split("String"),Di=Sr.exports=function(e,r,t){String(r).slice(0,7)==="Symbol("&&(r="["+String(r).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(r="get "+r),t&&t.setter&&(r="set "+r),(!se(e,"name")||Ei&&e.name!==r)&&(We?le(e,"name",{value:r,configurable:!0}):e.name=r),Ni&&t&&se(t,"arity")&&e.length!==t.arity&&le(e,"length",{value:t.arity});try{t&&se(t,"constructor")&&t.constructor?We&&le(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var n=Ti(e);return se(n,"source")||(n.source=Ri.join(typeof r=="string"?r:"")),e};Function.prototype.toString=Di(function(){return Ai(this)&&Mi(this).source||Pi(this)},"toString");var Ki=P,Fi=he,Ci=Sr.exports,Li=et,Ar=function(e,r,t,n){n||(n={});var o=n.enumerable,i=n.name!==void 0?n.name:r;if(Ki(t)&&Ci(t,i,n),n.global)o?e[r]=t:Li(r,t);else{try{n.unsafe?e[r]&&(o=!0):delete e[r]}catch{}o?e[r]=t:Fi.f(e,r,{value:t,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},Er={},ki=Math.ceil,Bi=Math.floor,Hi=Math.trunc||function(r){var t=+r;return(t>0?Bi:ki)(t)},zi=Hi,Pr=function(e){var r=+e;return r!==r||r===0?0:zi(r)},Ui=Pr,xi=Math.max,Wi=Math.min,qi=function(e,r){var t=Ui(e);return t<0?xi(t+r,0):Wi(t,r)},Gi=Pr,Vi=Math.min,Yi=function(e){return e>0?Vi(Gi(e),9007199254740991):0},Ji=Yi,Qi=function(e){return Ji(e.length)},Zi=Qe,Xi=qi,ea=Qi,Nt=function(e){return function(r,t,n){var o=Zi(r),i=ea(o),c=Xi(n,i),s;if(e&&t!=t){for(;i>c;)if(s=o[c++],s!=s)return!0}else for(;i>c;c++)if((e||c in o)&&o[c]===t)return e||c||0;return!e&&-1}},ta={includes:Nt(!0),indexOf:Nt(!1)},ra=R,Ke=B,na=Qe,oa=ta.indexOf,ia=Ir,Rt=ra([].push),Tr=function(e,r){var t=na(e),n=0,o=[],i;for(i in t)!Ke(ia,i)&&Ke(t,i)&&Rt(o,i);for(;r.length>n;)Ke(t,i=r[n++])&&(~oa(o,i)||Rt(o,i));return o},Mr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],aa=Tr,ca=Mr,sa=ca.concat("length","prototype");Er.f=Object.getOwnPropertyNames||function(r){return aa(r,sa)};var ot={};ot.f=Object.getOwnPropertySymbols;var la=Ze,ua=R,da=Er,va=ot,fa=pe,ya=ua([].concat),ga=la("Reflect","ownKeys")||function(r){var t=da.f(fa(r)),n=va.f;return n?ya(t,n(r)):t},Dt=B,ha=ga,pa=Ye,ba=he,wa=function(e,r,t){for(var n=ha(r),o=ba.f,i=pa.f,c=0;c<n.length;c++){var s=n[c];!Dt(e,s)&&!(t&&Dt(t,s))&&o(e,s,i(r,s))}},Sa=N,ma=P,_a=/#|\.prototype\./,te=function(e,r){var t=Ia[Oa(e)];return t==ja?!0:t==$a?!1:ma(r)?Sa(r):!!r},Oa=te.normalize=function(e){return String(e).replace(_a,".").toLowerCase()},Ia=te.data={},$a=te.NATIVE="N",ja=te.POLYFILL="P",Aa=te,Fe=K,Ea=Ye.f,Pa=wr,Ta=Ar,Ma=et,Na=wa,Ra=Aa,Da=function(e,r){var t=e.target,n=e.global,o=e.stat,i,c,s,u,d,a;if(n?c=Fe:o?c=Fe[t]||Ma(t,{}):c=(Fe[t]||{}).prototype,c)for(s in r){if(d=r[s],e.dontCallGetSet?(a=Ea(c,s),u=a&&a.value):u=c[s],i=Ra(n?s:t+(o?".":"#")+s,e.forced),!i&&u!==void 0){if(typeof d==typeof u)continue;Na(d,u)}(e.sham||u&&u.sham)&&Pa(d,"sham",!0),Ta(c,s,d,e)}},Ka=Tr,Fa=Mr,Ca=Object.keys||function(r){return Ka(r,Fa)},Kt=k,La=R,ka=X,Ba=N,Ce=Ca,Ha=ot,za=Je,Ua=yr,xa=cr,V=Object.assign,Ft=Object.defineProperty,Wa=La([].concat),qa=!V||Ba(function(){if(Kt&&V({b:1},V(Ft({},"a",{enumerable:!0,get:function(){Ft(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},t=Symbol(),n="abcdefghijklmnopqrst";return e[t]=7,n.split("").forEach(function(o){r[o]=o}),V({},e)[t]!=7||Ce(V({},r)).join("")!=n})?function(r,t){for(var n=Ua(r),o=arguments.length,i=1,c=Ha.f,s=za.f;o>i;)for(var u=xa(arguments[i++]),d=c?Wa(Ce(u),c(u)):Ce(u),a=d.length,l=0,v;a>l;)v=d[l++],(!Kt||ka(s,u,v))&&(n[v]=u[v]);return n}:V,Ga=Da,Ct=qa;Ga({target:"Object",stat:!0,arity:2,forced:Object.assign!==Ct},{assign:Ct});function O(e,r,t,n){function o(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function s(a){try{d(n.next(a))}catch(l){c(l)}}function u(a){try{d(n.throw(a))}catch(l){c(l)}}function d(a){a.done?i(a.value):o(a.value).then(s,u)}d((n=n.apply(e,r||[])).next())})}var Va=rt,Ya=Va("toStringTag"),Nr={};Nr[Ya]="z";var Ja=String(Nr)==="[object z]",Qa=Ja,Za=P,ue=ar,Xa=rt,ec=Xa("toStringTag"),tc=Object,rc=ue(function(){return arguments}())=="Arguments",nc=function(e,r){try{return e[r]}catch{}},oc=Qa?ue:function(e){var r,t,n;return e===void 0?"Undefined":e===null?"Null":typeof(t=nc(r=tc(e),ec))=="string"?t:rc?ue(r):(n=ue(r))=="Object"&&Za(r.callee)?"Arguments":n},ic=oc,ac=String,cc=function(e){if(ic(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return ac(e)},sc=pe,lc=function(){var e=sc(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},uc=X,dc=B,vc=lr,fc=lc,Lt=RegExp.prototype,yc=function(e){var r=e.flags;return r===void 0&&!("flags"in Lt)&&!dc(e,"flags")&&vc(Lt,e)?uc(fc,e):r},gc=_r.PROPER,hc=Ar,pc=pe,kt=cc,bc=N,wc=yc,it="toString",Sc=RegExp.prototype,Rr=Sc[it],mc=bc(function(){return Rr.call({source:"a",flags:"b"})!="/a/b"}),_c=gc&&Rr.name!=it;(mc||_c)&&hc(RegExp.prototype,it,function(){var r=pc(this),t=kt(r.source),n=kt(wc(r));return"/"+t+"/"+n},{unsafe:!0});const Oc=e=>O(void 0,void 0,void 0,function*(){const{store:r,logger:t,emitter:n,options:o,defaultProvider:i,defaultStrategy:c}=e,s=new xt.HereWallet({networkId:o.network.networkId,nodeUrl:o.network.nodeUrl,defaultProvider:i,defaultStrategy:c});function u(){return O(this,void 0,void 0,function*(){t.log("HereWallet:getAccounts");const d=yield s.getAccounts(),a=[];for(let l=0;l<d.length;l++)a.push({accountId:d[l],publicKey:(yield s.signer.getPublicKey(d[l],o.network.networkId)).toString()});return a})}return{get networkId(){return s.networkId},buildImportAccountsUrl(){return`https://my.herewallet.app/import?network=${o.network.networkId}`},account(d){return O(this,void 0,void 0,function*(){return t.log("HereWallet:account"),yield s.account(d)})},switchAccount(d){return O(this,void 0,void 0,function*(){t.log("HereWallet:switchAccount"),yield s.switchAccount(d)})},getAccountId(){return O(this,void 0,void 0,function*(){return t.log("HereWallet:getAccountId"),yield s.getAccountId()})},isSignedIn(){return O(this,void 0,void 0,function*(){return t.log("HereWallet:isSignedIn"),yield s.isSignedIn()})},signIn(d){var a;return O(this,void 0,void 0,function*(){t.log("HereWallet:signIn");const l=d.contractId!==""?d.contractId:void 0;return yield s.signIn(Object.assign(Object.assign({},d),{contractId:l})),n.emit("signedIn",{contractId:d.contractId,methodNames:(a=d.methodNames)!==null&&a!==void 0?a:[],accounts:yield u()}),yield u()})},getHereBalance(){return O(this,void 0,void 0,function*(){return t.log("HereWallet:getHereBalance"),yield s.getHereBalance()})},getAvailableBalance(){return O(this,void 0,void 0,function*(){return t.log("HereWallet:getAvailableBalance"),yield s.getAvailableBalance()})},signOut(){return O(this,void 0,void 0,function*(){t.log("HereWallet:signOut"),yield s.signOut()})},getAccounts(){return O(this,void 0,void 0,function*(){return u()})},signAndSendTransaction(d){return O(this,void 0,void 0,function*(){t.log("HereWallet:signAndSendTransaction",d);const{contract:a}=r.getState();if(!s.isSignedIn||!a)throw new Error("Wallet not signed in");return yield s.signAndSendTransaction(Object.assign({receiverId:a.contractId},d))})},verifyOwner(){return O(this,void 0,void 0,function*(){throw Error("HereWallet:verifyOwner is deprecated, use signMessage method with implementation NEP0413 Standard")})},signMessage(d){return O(this,void 0,void 0,function*(){return t.log("HereWallet:signMessage",d),yield s.signMessage(d)})},signAndSendTransactions(d){return O(this,void 0,void 0,function*(){return t.log("HereWallet:signAndSendTransactions",d),yield s.signAndSendTransactions(d)})}}});var Ic="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xOS43MzM1IDExLjY4MzFMMjEuNzA4OSA4TDI0LjI5ODMgMTYuNjc2NkwyMC40MTYgMTQuOTIxNUwxOS43MzM1IDExLjY4MzFaTTUuNzYzODggMTUuNTQwOUwzLjc1NTYyIDE5LjE2MjFMOS44OTYwNSAyMi4xNjYxTDE4LjM0NzMgMjEuNTgyOEw1Ljc2Mzg4IDE1LjU0MDlaTTQuNjQ0NjQgMjIuMzY5NEwyLjY0ODY1IDI1Ljk3MTNMMTQuOTA4MyAzMi4wNTc1TDM1LjMzODggMzAuODE3NEwzNy4zMzQ4IDI3LjIxNTRMMTYuOTA0MyAyOC40NTU3TDQuNjQ0NjQgMjIuMzY5NFoiIGZpbGw9IiMyQzMwMzQiLz4KPHBhdGggZD0iTTM3LjMzNTkgMjcuMjE1N0wxNi45MTEyIDI4LjQ1NjFMNC41NDYzMyAyMi4zNTU0TDE3LjkzNTggMjEuNTQ1M0w1Ljc2Mzg3IDE1LjU0MDlMMTEuNzQxIDEwLjQ3ODZMMjQuMTQwMSAxNi41NzYzTDIxLjcwOSA4TDMzLjU1NyAxMy44MUwzNy4zMzU5IDI3LjIxNTdaIiBmaWxsPSIjRkRCRjFDIi8+Cjwvc3ZnPgo=";function Tc({deprecated:e=!1,iconUrl:r=Ic,defaultStrategy:t,defaultProvider:n}={}){return()=>O(this,void 0,void 0,function*(){return{id:"here-wallet",type:"injected",metadata:{name:"Here Wallet",description:"Mobile wallet for NEAR Protocol",useUrlAccountImport:!0,downloadUrl:"https://herewallet.app",iconUrl:r,deprecated:e,available:!0},init:o=>Oc(Object.assign(Object.assign({},o),{defaultStrategy:t,defaultProvider:n}))}})}export{Tc as setupHereWallet};
