import{g as ot}from"./index.BbP3371Q.js";import{k as p,I as Ft,J as Lt,K as Er,L as Pr,E as kt,H as Ht,O as Mr,G as zt,Q as Tr,T as Nr,U as Rr}from"./TxSnackbar.svelte_svelte_type_style_lang.DiUD2h9M.js";import{B as U}from"./entry.DNdNmzbA.js";var Bt={},ye={},Y={},Q={},re=p&&p.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function s(o){try{d(n.next(o))}catch(l){c(l)}}function u(o){try{d(n.throw(o))}catch(l){c(l)}}function d(o){o.done?a(o.value):i(o.value).then(s,u)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(Q,"__esModule",{value:!0});Q.StateStorage=void 0;class Kr{constructor(){this.dataKey="herewallet:keystore"}setState(t,r){return re(this,void 0,void 0,function*(){const n=yield this.getFullState();n[t]=r,window.localStorage.setItem(this.dataKey,JSON.stringify(n))})}getFullState(){return re(this,void 0,void 0,function*(){try{return JSON.parse(window.localStorage.getItem(this.dataKey))||{}}catch{return{}}})}getState(t){return re(this,void 0,void 0,function*(){return(yield this.getFullState())[t]||{activeAccount:null,accounts:{}}})}clear(){return re(this,void 0,void 0,function*(){window.localStorage.removeItem(this.dataKey)})}}Q.StateStorage=Kr;var D=p&&p.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function s(o){try{d(n.next(o))}catch(l){c(l)}}function u(o){try{d(n.throw(o))}catch(l){c(l)}}function d(o){o.done?a(o.value):i(o.value).then(s,u)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(Y,"__esModule",{value:!0});Y.HereKeyStore=void 0;const Dr=Ft,Cr=Q;class Fr{constructor(t=new Cr.StateStorage){this.storage=t}setActiveAccount(t,r){return D(this,void 0,void 0,function*(){const n=yield this.storage.getState(t);n.activeAccount=r,this.storage.setState(t,n)})}setKey(t,r,n){return D(this,void 0,void 0,function*(){const i=yield this.storage.getState(t);i.accounts[r]=n.toString(),this.storage.setState(t,i)})}getAccounts(t){return D(this,void 0,void 0,function*(){const r=yield this.storage.getState(t);return Object.keys(r.accounts)})}getActiveAccount(t){return D(this,void 0,void 0,function*(){return(yield this.storage.getState(t)).activeAccount})}getKey(t,r){return D(this,void 0,void 0,function*(){const i=(yield this.storage.getState(t)).accounts[r];if(i==null)throw Error(`For ${r} in ${t} network key not found`);return Dr.KeyPair.fromString(i)})}removeKey(t,r){return D(this,void 0,void 0,function*(){let n=yield this.storage.getState(t);n.activeAccount===r&&(n.activeAccount=null),delete n.accounts[r],this.storage.setState(t,n)})}getNetworks(){return D(this,void 0,void 0,function*(){let t=yield this.storage.getFullState();return Object.keys(t.accounts)})}clear(){return D(this,void 0,void 0,function*(){yield this.storage.clear()})}}Y.HereKeyStore=Fr;var Z={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HereProviderError=e.HereProviderStatus=void 0,function(r){r[r.APPROVING=1]="APPROVING",r[r.FAILED=2]="FAILED",r[r.SUCCESS=3]="SUCCESS"}(e.HereProviderStatus||(e.HereProviderStatus={}));class t extends Error{constructor(n,i){super(n??(i==null?void 0:i.message)),this.payload=n,this.parentError=i}}e.HereProviderError=t})(Z);var S={},Lr=p&&p.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function s(o){try{d(n.next(o))}catch(l){c(l)}}function u(o){try{d(n.throw(o))}catch(l){c(l)}}function d(o){o.done?a(o.value):i(o.value).then(s,u)}d((n=n.apply(e,t||[])).next())})},kr=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(S,"__esModule",{value:!0});S.isValidAccessKey=S.internalThrow=S.getPublicKeys=S.serializeActions=S.isMobile=S.getDeviceId=void 0;const Hr=kr(Lt),at=Z,zr=()=>{const e=window.localStorage.getItem("herewallet-topic")||(0,Hr.default)();return window.localStorage.setItem("herewallet-topic",e),e};S.getDeviceId=zr;const Br=()=>window.matchMedia("(any-pointer:coarse)").matches;S.isMobile=Br;const Wr=e=>e.map(t=>{if(t.type!=="FunctionCall")return t;let{args:r,deposit:n,gas:i,methodName:a}=t.params;return ArrayBuffer.isView(r)&&(r=U.from(r.buffer,r.byteOffset,r.byteLength)),r instanceof U&&(r=r.toString("base64")),{type:t.type,params:{args:r,deposit:n,gas:i,methodName:a}}});S.serializeActions=Wr;const Ur=(e,t)=>Lr(void 0,void 0,void 0,function*(){const r=yield fetch(e,{method:"POST",body:JSON.stringify({jsonrpc:"2.0",id:"dontcare",method:"query",params:{request_type:"view_access_key_list",finality:"final",account_id:t}}),headers:{"content-type":"application/json"}});return r.ok===!1?[]:(yield r.json()).result.keys});S.getPublicKeys=Ur;const qr=(e,t)=>{var r,n,i;if(e instanceof at.HereProviderError)throw e;const a={payload:e instanceof Error?e.message:"UNKNOWN",status:at.HereProviderStatus.FAILED,account_id:""};throw(r=t.onFailed)===null||r===void 0||r.call(t,a),(i=(n=t==null?void 0:t.strategy)===null||n===void 0?void 0:n.onFailed)===null||i===void 0||i.call(n,a),e};S.internalThrow=qr;const Gr=(e,t,r)=>{const{permission:n}=t.access_key;if(n==="FullAccess")return!0;if(n.FunctionCall){const{receiver_id:i,method_names:a}=n.FunctionCall;if(i===e&&a.includes("add_request_and_confirm"))return!0;if(i===r.receiverId)return r.actions.length!==1?!1:r.actions.every(c=>c.type!=="FunctionCall"?!1:(!c.params.deposit||c.params.deposit.toString()==="0")&&(a.length===0||a.includes(c.params.methodName)))}return!1};S.isValidAccessKey=Gr;var Ue={},Wt={};(function(e){var t=p&&p.__awaiter||function(l,f,v,y){function h(g){return g instanceof v?g:new v(function(b){b(g)})}return new(v||(v=Promise))(function(g,b){function O(I){try{N(y.next(I))}catch(k){b(k)}}function E(I){try{N(y.throw(I))}catch(k){b(k)}}function N(I){I.done?g(I.value):h(I.value).then(O,E)}N((y=y.apply(l,f||[])).next())})},r=p&&p.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0}),e.createRequest=e.deleteRequest=e.getResponse=e.getRequest=e.proxyApi=void 0;const n=r(Er),i=r(Lt),a=Pr,c=S;e.proxyApi="https://h4n.app";const s=(l,f)=>t(void 0,void 0,void 0,function*(){const v=yield fetch(`${e.proxyApi}/${l}/request`,{signal:f,headers:{"content-type":"application/json"},method:"GET"});if(v.ok===!1)throw Error(yield v.text());const{data:y}=yield v.json();return JSON.parse((0,a.base_decode)(y).toString("utf8"))});e.getRequest=s;const u=l=>t(void 0,void 0,void 0,function*(){var f,v,y,h;const g=yield fetch(`${e.proxyApi}/${l}/response`,{headers:{"content-type":"application/json"},method:"GET"});if(g.ok===!1)throw Error(yield g.text());const{data:b}=yield g.json(),O=(f=JSON.parse(b))!==null&&f!==void 0?f:{};return{account_id:(v=O.account_id)!==null&&v!==void 0?v:"",payload:(y=O.payload)!==null&&y!==void 0?y:"",status:(h=O.status)!==null&&h!==void 0?h:-1,topic:O.topic}});e.getResponse=u;const d=l=>t(void 0,void 0,void 0,function*(){const f=yield fetch(`${e.proxyApi}/${l}`,{headers:{"content-type":"application/json"},method:"DELETE"});if(f.ok===!1)throw Error(yield f.text())});e.deleteRequest=d;const o=(l,f)=>t(void 0,void 0,void 0,function*(){const v=(0,a.base_encode)(JSON.stringify(Object.assign(Object.assign({},l),{_id:(0,i.default)()}))),y=(0,n.default)(v),g=U.from(y,"hex").toString("base64").replaceAll("/","_").replaceAll("-","+").slice(0,13),b=yield fetch(`${e.proxyApi}/${g}/request`,{method:"POST",signal:f,body:JSON.stringify({topic_id:(0,c.getDeviceId)(),data:v}),headers:{"content-type":"application/json"}});if(b.ok===!1)throw Error(yield b.text());return g});e.createRequest=o})(Wt);(function(e){var t=p&&p.__awaiter||function(s,u,d,o){function l(f){return f instanceof d?f:new d(function(v){v(f)})}return new(d||(d=Promise))(function(f,v){function y(b){try{g(o.next(b))}catch(O){v(O)}}function h(b){try{g(o.throw(b))}catch(O){v(O)}}function g(b){b.done?f(b.value):l(b.value).then(y,h)}g((o=o.apply(s,u||[])).next())})},r=p&&p.__rest||function(s,u){var d={};for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&u.indexOf(o)<0&&(d[o]=s[o]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(s);l<o.length;l++)u.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(s,o[l])&&(d[o[l]]=s[o[l]]);return d};Object.defineProperty(e,"__esModule",{value:!0}),e.proxyProvider=e.getRequest=e.proxyApi=e.deleteRequest=e.getResponse=e.createRequest=void 0;const n=S,i=Z,a=Wt;Object.defineProperty(e,"createRequest",{enumerable:!0,get:function(){return a.createRequest}}),Object.defineProperty(e,"getResponse",{enumerable:!0,get:function(){return a.getResponse}}),Object.defineProperty(e,"deleteRequest",{enumerable:!0,get:function(){return a.deleteRequest}}),Object.defineProperty(e,"proxyApi",{enumerable:!0,get:function(){return a.proxyApi}}),Object.defineProperty(e,"getRequest",{enumerable:!0,get:function(){return a.getRequest}});const c=s=>t(void 0,void 0,void 0,function*(){let{strategy:u,request:d,disableCleanupRequest:o,id:l,signal:f}=s,v=r(s,["strategy","request","disableCleanupRequest","id","signal"]);return l!=null?d=yield(0,a.getRequest)(l,f):l=yield(0,a.createRequest)(d,f),new Promise((y,h)=>{var g,b;const O=a.proxyApi.replace("https","wss");let E=null,N=null;const I=()=>t(void 0,void 0,void 0,function*(){E=-1,clearInterval(E),N==null||N.close(),o!==!0&&(yield(0,a.deleteRequest)(l))}),k=w=>{var P,$,q,K,H,we;switch(w.status){case i.HereProviderStatus.APPROVING:(P=v.onApproving)===null||P===void 0||P.call(v,w),($=u==null?void 0:u.onApproving)===null||$===void 0||$.call(u,w);return;case i.HereProviderStatus.FAILED:I(),h(new i.HereProviderError(w.payload)),(q=v.onFailed)===null||q===void 0||q.call(v,w),(K=u==null?void 0:u.onFailed)===null||K===void 0||K.call(u,w);return;case i.HereProviderStatus.SUCCESS:I(),y(w),(H=v.onSuccess)===null||H===void 0||H.call(v,w),(we=u==null?void 0:u.onSuccess)===null||we===void 0||we.call(u,w);return}},be=w=>{k({status:i.HereProviderStatus.FAILED,payload:w})};(g=v.onRequested)===null||g===void 0||g.call(v,l,d,be),(b=u==null?void 0:u.onRequested)===null||b===void 0||b.call(u,l,d,be),f==null||f.addEventListener("abort",()=>be());const it=()=>{E!==-1&&(E=setTimeout(()=>t(void 0,void 0,void 0,function*(){var w,P;try{const $=yield(0,a.getResponse)(l);if(E===-1)return;k($),it()}catch($){const q=i.HereProviderStatus.FAILED,K=$ instanceof Error?$:void 0,H=K==null?void 0:K.message;I(),h(new i.HereProviderError(H,K)),(w=v.onFailed)===null||w===void 0||w.call(v,{status:q,payload:H}),(P=u==null?void 0:u.onFailed)===null||P===void 0||P.call(u,{status:q,payload:H})}}),3e3))};if(it(),(0,n.isMobile)()===!1){const w=`${O}/ws/${l}`;N=new WebSocket(w),N.onmessage=P=>{if(P.data!=null)try{const $=JSON.parse(P.data);k($)}catch{}}}})});e.proxyProvider=c})(Ue);var qe={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createAction=e.parseArgs=void 0;const t=kt,r=Ht,n=c=>{if(c==="FullAccess")return r.transactions.fullAccessKey();const{receiverId:s,methodNames:u=[]}=c,d=c.allowance?new t.BN(c.allowance):void 0;return r.transactions.functionCallAccessKey(s,u,d)},i=c=>typeof c=="string"?U.from(c,"base64"):c;e.parseArgs=i;const a=c=>{switch(c.type){case"CreateAccount":return r.transactions.createAccount();case"DeployContract":{const{code:s}=c.params;return r.transactions.deployContract(s)}case"FunctionCall":{const{methodName:s,args:u,gas:d,deposit:o}=c.params;return r.transactions.functionCall(s,(0,e.parseArgs)(u),new t.BN(d),new t.BN(o))}case"Transfer":{const{deposit:s}=c.params;return r.transactions.transfer(new t.BN(s))}case"Stake":{const{stake:s,publicKey:u}=c.params;return r.transactions.stake(new t.BN(s),r.utils.PublicKey.from(u))}case"AddKey":{const{publicKey:s,accessKey:u}=c.params;return r.transactions.addKey(r.utils.PublicKey.from(s),n(u.permission))}case"DeleteKey":{const{publicKey:s}=c.params;return r.transactions.deleteKey(r.utils.PublicKey.from(s))}case"DeleteAccount":{const{beneficiaryId:s}=c.params;return r.transactions.deleteAccount(s)}default:throw new Error("Invalid action type")}};e.createAction=a})(qe);var Ge={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WidgetStrategy=e.defaultUrl=void 0;const t=n=>{const i=document.createElement("iframe");return i.src=n,i.style.border="none",i.style.zIndex="10000",i.style.position="fixed",i.style.display="none",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",document.body.appendChild(i),i};e.defaultUrl="https://my.herewallet.app/connector/index.html";class r{constructor(i={widget:e.defaultUrl,lazy:!1}){this.options={lazy:typeof i=="object"&&i.lazy||!1,widget:typeof i=="string"?i:i.widget||e.defaultUrl},this.options.lazy||this.initIframe()}initIframe(){return r.connector==null&&(r.connector=t(this.options.widget),r.connector.addEventListener("load",()=>{r.isLoaded=!0})),r.connector}onRequested(i,a,c){const s=this.initIframe();s.style.display="block";const u=()=>{var d,o,l;(d=r.connector)===null||d===void 0||d.removeEventListener("load",u),(l=(o=r.connector)===null||o===void 0?void 0:o.contentWindow)===null||l===void 0||l.postMessage(JSON.stringify({type:"request",payload:{id:i,request:a}}),new URL(this.options.widget).origin)};r.isLoaded?u():s.addEventListener("load",u),this.messageHandler=d=>{try{if(d.origin!==new URL(this.options.widget).origin)return;JSON.parse(d.data).type==="reject"&&c()}catch{}},window.addEventListener("message",this.messageHandler)}postMessage(i){var a;const c=this.initIframe(),s=JSON.stringify(i),u=new URL(this.options.widget).origin;(a=c.contentWindow)===null||a===void 0||a.postMessage(s,u)}onApproving(){this.postMessage({type:"approving"})}onSuccess(i){console.log(i),this.postMessage({type:"result",payload:{request:i}}),this.close()}onFailed(i){this.postMessage({type:"result",payload:{request:i}}),this.close()}close(){this.messageHandler&&(window.removeEventListener("message",this.messageHandler),this.messageHandler=void 0),r.connector&&(r.connector.style.display="none")}}e.WidgetStrategy=r,r.isLoaded=!1})(Ge);var Ut={};(function(e){var t=p&&p.__createBinding||(Object.create?function(o,l,f,v){v===void 0&&(v=f),Object.defineProperty(o,v,{enumerable:!0,get:function(){return l[f]}})}:function(o,l,f,v){v===void 0&&(v=f),o[v]=l[f]}),r=p&&p.__setModuleDefault||(Object.create?function(o,l){Object.defineProperty(o,"default",{enumerable:!0,value:l})}:function(o,l){o.default=l}),n=p&&p.__importStar||function(o){if(o&&o.__esModule)return o;var l={};if(o!=null)for(var f in o)f!=="default"&&Object.prototype.hasOwnProperty.call(o,f)&&t(l,o,f);return r(l,o),l},i=p&&p.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.verifySignature=e.authPayloadSchema=e.AuthPayload=void 0;const a=n(Mr),c=i(zt),s=Tr;class u{constructor({message:l,nonce:f,recipient:v,callbackUrl:y}){this.tag=2147484061,this.message=l,this.nonce=f,this.recipient=v,y&&(this.callbackUrl=y)}}e.AuthPayload=u,e.authPayloadSchema=new Map([[u,{kind:"struct",fields:[["tag","u32"],["message","string"],["nonce",[32]],["recipient","string"],["callbackUrl",{kind:"option",type:"string"}]]}]]);function d(o,l){const f=new u(o),v=a.serialize(e.authPayloadSchema,f),y=Uint8Array.from(c.default.sha256.array(v));let h=new Uint8Array(U.from(l.signature,"base64"));return s.PublicKey.from(l.publicKey).verify(y,h)}e.verifySignature=d})(Ut);var m=p&&p.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function s(o){try{d(n.next(o))}catch(l){c(l)}}function u(o){try{d(n.throw(o))}catch(l){c(l)}}function d(o){o.done?a(o.value):i(o.value).then(s,u)}d((n=n.apply(e,t||[])).next())})},ne=p&&p.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r},xr=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ye,"__esModule",{value:!0});ye.HereWallet=void 0;const ie=Ht,Vr=Rr,Se=Ft,Jr=zt,Yr=Nr(),me=xr(kt),Qr=Y,ct=Z,C=S,Zr=Ue,Xr=qe,en=Ge,tn=Ut;class z extends Error{}class rn{constructor({nodeUrl:t,networkId:r="mainnet",authStorage:n=new Qr.HereKeyStore,defaultStrategy:i=()=>new en.WidgetStrategy,defaultProvider:a=Zr.proxyProvider}={}){this.authStorage=n,this.defaultProvider=a,this.defaultStrategy=i;const c=new ie.InMemorySigner(this.authStorage),s=new Vr.JsonRpcProvider({url:t??`https://rpc.${r}.near.org`});this.connection=ie.Connection.fromConfig({jsvmAccountId:`jsvm.${r}`,provider:s,networkId:r,signer:c})}get rpc(){return this.connection.provider}get signer(){return this.connection.signer}get networkId(){return this.connection.networkId}account(t){return m(this,void 0,void 0,function*(){const r=t??(yield this.authStorage.getActiveAccount(this.networkId));if(r==null)throw new z("Wallet not signed in");return new ie.Account(this.connection,r)})}isSignedIn(){return m(this,void 0,void 0,function*(){return(yield this.authStorage.getActiveAccount(this.networkId))!=null})}signOut(){return m(this,void 0,void 0,function*(){const t=yield this.authStorage.getActiveAccount(this.networkId);if(t==null)throw new z("Wallet not signed in");const r=yield this.authStorage.getKey(this.networkId,t);if(r!=null){const n=r.getPublicKey().toString();yield this.silentSignAndSendTransaction({receiverId:t,actions:[{type:"DeleteKey",params:{publicKey:n}}]}).catch(()=>{})}yield this.authStorage.removeKey(this.networkId,t)})}getHereBalance(t){return m(this,void 0,void 0,function*(){const r=yield this.account(t),n=this.networkId==="mainnet"?"here.storage.near":"here.storage.testnet",i=yield r.viewFunction({args:{account_id:r.accountId},methodName:"ft_balance_of",contractId:n}).catch(()=>"0");return new me.default(i)})}getAvailableBalance(t){return m(this,void 0,void 0,function*(){const n=yield(yield this.account(t)).getAccountBalance(),i=yield this.getHereBalance();return new me.default(n.available).add(new me.default(i))})}getAccounts(){return m(this,void 0,void 0,function*(){return yield this.authStorage.getAccounts(this.networkId)})}getAccountId(){return m(this,void 0,void 0,function*(){const t=yield this.authStorage.getActiveAccount(this.networkId);if(t==null)throw new z("Wallet not signed in");return t})}switchAccount(t){return m(this,void 0,void 0,function*(){if((yield this.authStorage.getKey(this.networkId,t))==null)throw new Error(`Account ${t} not signed in`);yield this.authStorage.setActiveAccount(this.networkId,t)})}signIn(t={}){var r,n,i,a,c,{contractId:s,allowance:u,methodNames:d=[]}=t,o=ne(t,["contractId","allowance","methodNames"]);return m(this,void 0,void 0,function*(){if(s==null){const{accountId:l}=yield this.authenticate(o);return yield this.authStorage.setKey(this.networkId,l,Se.KeyPairEd25519.fromRandom()),yield this.authStorage.setActiveAccount(this.networkId,l),l}o.strategy=(r=o.strategy)!==null&&r!==void 0?r:this.defaultStrategy(),o.provider=(n=o.provider)!==null&&n!==void 0?n:this.defaultProvider,(i=o.onInitialized)===null||i===void 0||i.call(o),(c=(a=o.strategy)===null||a===void 0?void 0:a.onInitialized)===null||c===void 0||c.call(a);try{const l=ie.KeyPair.fromRandom("ed25519"),f={receiverId:s,methodNames:d,allowance:u},v=yield o.provider(Object.assign(Object.assign({},o),{request:{type:"call",network:this.networkId,transactions:[{actions:[{type:"AddKey",params:{publicKey:l.getPublicKey().toString(),accessKey:{permission:f}}}]}]}}));if(v.account_id==null)throw Error("Transaction is failed");return yield this.authStorage.setKey(this.networkId,v.account_id,l),yield this.authStorage.setActiveAccount(this.networkId,v.account_id),v.account_id}catch(l){throw(0,C.internalThrow)(l,o),l}})}silentSignAndSendTransaction({actions:t,receiverId:r,signerId:n}){return m(this,void 0,void 0,function*(){const i=yield this.account(n),a=yield this.authStorage.getKey(this.networkId,i.accountId);if(a==null)throw new z;const c=a.getPublicKey(),s=yield i.getAccessKeys(),u={receiverId:r,actions:t};if(s.some(o=>o.public_key!==c.toString()?!1:(0,C.isValidAccessKey)(i.accountId,o,u))===!1)throw new z;return yield i.signAndSendTransaction({actions:t.map(o=>(0,Xr.createAction)(o)),receiverId:r??i.accountId})})}signAndSendTransaction(t){var r,n,i,a,c,s,u,d;return m(this,void 0,void 0,function*(){const{signerId:o,receiverId:l,actions:f}=t,y=ne(t,["signerId","receiverId","actions"]);y.strategy=(r=y.strategy)!==null&&r!==void 0?r:this.defaultStrategy(),y.provider=(n=y.provider)!==null&&n!==void 0?n:this.defaultProvider,(i=y.onInitialized)===null||i===void 0||i.call(y),(c=(a=y.strategy)===null||a===void 0?void 0:a.onInitialized)===null||c===void 0||c.call(a);try{const h=yield this.silentSignAndSendTransaction({receiverId:l,actions:f,signerId:o}),g={status:ct.HereProviderStatus.SUCCESS,payload:h==null?void 0:h.transaction_outcome.id};return(s=y.onSuccess)===null||s===void 0||s.call(y,g),(d=(u=y.strategy)===null||u===void 0?void 0:u.onSuccess)===null||d===void 0||d.call(u,g),h}catch(h){try{if(!(h instanceof z)&&(h==null?void 0:h.type)!=="NotEnoughAllowance")throw(0,C.internalThrow)(h,y),h;const g=yield y.provider(Object.assign(Object.assign({},y),{request:{type:"call",transactions:[{actions:(0,C.serializeActions)(f),receiverId:l,signerId:o}],network:this.networkId}}));if(g.payload==null||g.account_id==null)throw Error("Transaction not found, but maybe executed");return yield this.rpc.txStatus(g.payload,g.account_id)}catch(g){throw(0,C.internalThrow)(g,y),g}}})}verifyMessageNEP0413(t,r){return m(this,void 0,void 0,function*(){if(!(0,tn.verifySignature)(t,r))throw Error("Incorrect signature");if(!(yield(yield this.account(r.accountId)).getAccessKeys()).some(s=>!(s.public_key!==r.publicKey||s.access_key.permission!=="FullAccess")))throw Error("Signer public key is not full access");return!0})}authenticate(t={}){var r,n,i;return m(this,void 0,void 0,function*(){const a={nonce:(r=t.nonce)!==null&&r!==void 0?r:(0,Yr.randomBytes)(32),recipient:(n=t.recipient)!==null&&n!==void 0?n:window.location.host,message:(i=t.message)!==null&&i!==void 0?i:"Authenticate"},c=yield this.signMessage(Object.assign(Object.assign({},a),t));return yield this.verifyMessageNEP0413(a,c),c})}signMessage(t){var r,n,i,a,c;return m(this,void 0,void 0,function*(){if(t.strategy=(r=t.strategy)!==null&&r!==void 0?r:this.defaultStrategy(),t.provider=(n=t.provider)!==null&&n!==void 0?n:this.defaultProvider,(i=t.onInitialized)===null||i===void 0||i.call(t),(c=(a=t.strategy)===null||a===void 0?void 0:a.onInitialized)===null||c===void 0||c.call(a),"receiver"in t)return yield this.legacySignMessage(t);const s=yield t.provider(Object.assign(Object.assign({},t),{request:{type:"sign",message:t.message,recipient:t.recipient,nonce:Array.from(t.nonce),network:this.networkId}}));if((s==null?void 0:s.payload)==null)throw Error("Signature not found");const{publicKey:u,signature:d,accountId:o}=JSON.parse(s.payload);return{publicKey:u,signature:d,accountId:o}})}legacySignMessage(t){var r,{message:n,receiver:i,nonce:a}=t,c=ne(t,["message","receiver","nonce"]);return m(this,void 0,void 0,function*(){if(a==null){let u=new Uint8Array(32);a=[...crypto.getRandomValues(u)]}const s=yield(r=c.provider)===null||r===void 0?void 0:r.call(c,Object.assign(Object.assign({},c),{request:{type:"sign",message:n,receiver:i,nonce:a,network:this.networkId}}));if((s==null?void 0:s.payload)==null)throw Error("Signature not found");try{const{publicKey:u,signature:d,accountId:o}=JSON.parse(s.payload),l=new Uint8Array(U.from(d,"base64")),f=JSON.stringify({message:n,receiver:i,nonce:a}),v=new Uint8Array(Jr.sha256.digest("NEP0413:"+f));if(Se.PublicKey.from(u).verify(v,l)===!1)throw Error();const g=yield(yield this.account(o)).getAccessKeys(),b=u.toString();if(g.some(E=>!(E.public_key!==b||E.access_key.permission!=="FullAccess"))===!1)throw Error();return{signature:new Uint8Array(U.from(d,"base64")),publicKey:Se.PublicKey.from(u),message:"NEP0413:"+f,receiver:i,accountId:o,nonce:a}}catch{throw Error("Signature not correct")}})}signAndSendTransactions(t){var r,n,i,a,c,s,u,d,{transactions:o}=t,l=ne(t,["transactions"]);return m(this,void 0,void 0,function*(){l.strategy=(r=l.strategy)!==null&&r!==void 0?r:this.defaultStrategy(),l.provider=(n=l.provider)!==null&&n!==void 0?n:this.defaultProvider,(i=l.onInitialized)===null||i===void 0||i.call(l),(c=(a=l.strategy)===null||a===void 0?void 0:a.onInitialized)===null||c===void 0||c.call(a);let f=[];try{for(const h of o){const g=yield this.silentSignAndSendTransaction(h);f.push(g)}const v=f.map(h=>h.transaction_outcome.id).join(","),y={status:ct.HereProviderStatus.SUCCESS,payload:v};return(s=l.onSuccess)===null||s===void 0||s.call(l,y),(d=(u=l.strategy)===null||u===void 0?void 0:u.onSuccess)===null||d===void 0||d.call(u,y),f}catch(v){try{if(!(v instanceof z)&&(v==null?void 0:v.type)!=="NotEnoughAllowance")throw(0,C.internalThrow)(v,l),v;const y=o.slice(f.length),h=yield l.provider(Object.assign(Object.assign({},l),{request:{type:"call",transactions:y.map(b=>Object.assign(Object.assign({},b),{actions:(0,C.serializeActions)(b.actions)})),network:this.networkId}}));if(h.payload==null||h.account_id==null)throw Error("Transaction not found, but maybe executed");const g=h.payload.split(",").map(b=>this.rpc.txStatus(b,h.account_id));return yield Promise.all(g)}catch(y){throw(0,C.internalThrow)(y,l),y}}})}}ye.HereWallet=rn;var qt={};Object.defineProperty(qt,"__esModule",{value:!0});var ge={};Object.defineProperty(ge,"__esModule",{value:!0});ge.WindowStrategy=void 0;class nn{constructor(t="https://my.herewallet.app"){this.endpoint=t,this.signWindow=null,this.onFailed=()=>this.close(),this.onSuccess=()=>this.close()}onInitialized(){if(this.signWindow)return;const t=window.innerWidth/2-420/2,r=window.innerHeight/2-700/2;this.signWindow=window.open(`${this.endpoint}/loading`,"_blank",`popup=1,width=420,height=700,top=${r},left=${t}`)}onRequested(t,r,n){this.signWindow!=null&&(this.unloadHandler=()=>{var i;return(i=this.signWindow)===null||i===void 0?void 0:i.close()},window.addEventListener("beforeunload",this.unloadHandler),this.signWindow.location=`${this.endpoint}/request/${t}`,this.timerHandler=setInterval(()=>{var i;!((i=this.signWindow)===null||i===void 0)&&i.closed&&n("CLOSED")},1e3))}close(){var t;clearInterval(this.timerHandler),(t=this.signWindow)===null||t===void 0||t.close(),this.signWindow=null,this.unloadHandler&&window.removeEventListener("beforeunload",this.unloadHandler)}}ge.WindowStrategy=nn;var Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});(function(e){var t=p&&p.__createBinding||(Object.create?function(i,a,c,s){s===void 0&&(s=c),Object.defineProperty(i,s,{enumerable:!0,get:function(){return a[c]}})}:function(i,a,c,s){s===void 0&&(s=c),i[s]=a[c]}),r=p&&p.__exportStar||function(i,a){for(var c in i)c!=="default"&&!Object.prototype.hasOwnProperty.call(a,c)&&t(a,i,c)};Object.defineProperty(e,"__esModule",{value:!0}),e.HereWallet=void 0;var n=ye;Object.defineProperty(e,"HereWallet",{enumerable:!0,get:function(){return n.HereWallet}}),r(qe,e),r(Y,e),r(Q,e),r(qt,e),r(Ge,e),r(ge,e),r(Z,e),r(Gt,e),r(S,e),r(Ue,e)})(Bt);var st=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ot<"u"?ot:typeof self<"u"?self:{},oe=function(e){return e&&e.Math==Math&&e},R=oe(typeof globalThis=="object"&&globalThis)||oe(typeof window=="object"&&window)||oe(typeof self=="object"&&self)||oe(typeof st=="object"&&st)||function(){return this}()||Function("return this")(),xe={},M=function(e){try{return!!e()}catch{return!0}},on=M,F=!on(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),an=M,xt=!an(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),cn=xt,ae=Function.prototype.call,X=cn?ae.bind(ae):function(){return ae.apply(ae,arguments)},Ve={},Vt={}.propertyIsEnumerable,Jt=Object.getOwnPropertyDescriptor,sn=Jt&&!Vt.call({1:2},1);Ve.f=sn?function(t){var r=Jt(this,t);return!!r&&r.enumerable}:Vt;var Yt=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}},Qt=xt,Zt=Function.prototype,ln=Zt.bind,Le=Zt.call,un=Qt&&ln.bind(Le,Le),T=Qt?function(e){return e&&un(e)}:function(e){return e&&function(){return Le.apply(e,arguments)}},Xt=T,dn=Xt({}.toString),vn=Xt("".slice),er=function(e){return vn(dn(e),8,-1)},fn=T,yn=M,gn=er,_e=Object,hn=fn("".split),tr=yn(function(){return!_e("z").propertyIsEnumerable(0)})?function(e){return gn(e)=="String"?hn(e,""):_e(e)}:_e,pn=TypeError,rr=function(e){if(e==null)throw pn("Can't call method on "+e);return e},bn=tr,wn=rr,Je=function(e){return bn(wn(e))},A=function(e){return typeof e=="function"},Sn=A,ee=function(e){return typeof e=="object"?e!==null:Sn(e)},Oe=R,mn=A,_n=function(e){return mn(e)?e:void 0},Ye=function(e,t){return arguments.length<2?_n(Oe[e]):Oe[e]&&Oe[e][t]},On=T,nr=On({}.isPrototypeOf),In=Ye,$n=In("navigator","userAgent")||"",ir=R,Ie=$n,lt=ir.process,ut=ir.Deno,dt=lt&&lt.versions||ut&&ut.version,vt=dt&&dt.v8,j,de;vt&&(j=vt.split("."),de=j[0]>0&&j[0]<4?1:+(j[0]+j[1]));!de&&Ie&&(j=Ie.match(/Edge\/(\d+)/),(!j||j[1]>=74)&&(j=Ie.match(/Chrome\/(\d+)/),j&&(de=+j[1])));var jn=de,ft=jn,An=M,or=!!Object.getOwnPropertySymbols&&!An(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ft&&ft<41}),En=or,ar=En&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Pn=Ye,Mn=A,Tn=nr,Nn=ar,Rn=Object,cr=Nn?function(e){return typeof e=="symbol"}:function(e){var t=Pn("Symbol");return Mn(t)&&Tn(t.prototype,Rn(e))},Kn=String,Dn=function(e){try{return Kn(e)}catch{return"Object"}},Cn=A,Fn=Dn,Ln=TypeError,kn=function(e){if(Cn(e))return e;throw Ln(Fn(e)+" is not a function")},Hn=kn,zn=function(e,t){var r=e[t];return r==null?void 0:Hn(r)},$e=X,je=A,Ae=ee,Bn=TypeError,Wn=function(e,t){var r,n;if(t==="string"&&je(r=e.toString)&&!Ae(n=$e(r,e))||je(r=e.valueOf)&&!Ae(n=$e(r,e))||t!=="string"&&je(r=e.toString)&&!Ae(n=$e(r,e)))return n;throw Bn("Can't convert object to primitive value")},Qe={exports:{}},yt=R,Un=Object.defineProperty,Ze=function(e,t){try{Un(yt,e,{value:t,configurable:!0,writable:!0})}catch{yt[e]=t}return t},qn=R,Gn=Ze,gt="__core-js_shared__",xn=qn[gt]||Gn(gt,{}),Xe=xn,ht=Xe;(Qe.exports=function(e,t){return ht[e]||(ht[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.23.3",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Vn=rr,Jn=Object,sr=function(e){return Jn(Vn(e))},Yn=T,Qn=sr,Zn=Yn({}.hasOwnProperty),L=Object.hasOwn||function(t,r){return Zn(Qn(t),r)},Xn=T,ei=0,ti=Math.random(),ri=Xn(1 .toString),lr=function(e){return"Symbol("+(e===void 0?"":e)+")_"+ri(++ei+ti,36)},ni=R,ii=Qe.exports,pt=L,oi=lr,bt=or,ur=ar,G=ii("wks"),W=ni.Symbol,wt=W&&W.for,ai=ur?W:W&&W.withoutSetter||oi,et=function(e){if(!pt(G,e)||!(bt||typeof G[e]=="string")){var t="Symbol."+e;bt&&pt(W,e)?G[e]=W[e]:ur&&wt?G[e]=wt(t):G[e]=ai(t)}return G[e]},ci=X,St=ee,mt=cr,si=zn,li=Wn,ui=et,di=TypeError,vi=ui("toPrimitive"),fi=function(e,t){if(!St(e)||mt(e))return e;var r=si(e,vi),n;if(r){if(t===void 0&&(t="default"),n=ci(r,e,t),!St(n)||mt(n))return n;throw di("Can't convert object to primitive value")}return t===void 0&&(t="number"),li(e,t)},yi=fi,gi=cr,dr=function(e){var t=yi(e,"string");return gi(t)?t:t+""},hi=R,_t=ee,ke=hi.document,pi=_t(ke)&&_t(ke.createElement),bi=function(e){return pi?ke.createElement(e):{}},wi=F,Si=M,mi=bi,vr=!wi&&!Si(function(){return Object.defineProperty(mi("div"),"a",{get:function(){return 7}}).a!=7}),_i=F,Oi=X,Ii=Ve,$i=Yt,ji=Je,Ai=dr,Ei=L,Pi=vr,Ot=Object.getOwnPropertyDescriptor;xe.f=_i?Ot:function(t,r){if(t=ji(t),r=Ai(r),Pi)try{return Ot(t,r)}catch{}if(Ei(t,r))return $i(!Oi(Ii.f,t,r),t[r])};var he={},Mi=F,Ti=M,Ni=Mi&&Ti(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Ri=ee,Ki=String,Di=TypeError,pe=function(e){if(Ri(e))return e;throw Di(Ki(e)+" is not an object")},Ci=F,Fi=vr,Li=Ni,ce=pe,It=dr,ki=TypeError,Ee=Object.defineProperty,Hi=Object.getOwnPropertyDescriptor,Pe="enumerable",Me="configurable",Te="writable";he.f=Ci?Li?function(t,r,n){if(ce(t),r=It(r),ce(n),typeof t=="function"&&r==="prototype"&&"value"in n&&Te in n&&!n[Te]){var i=Hi(t,r);i&&i[Te]&&(t[r]=n.value,n={configurable:Me in n?n[Me]:i[Me],enumerable:Pe in n?n[Pe]:i[Pe],writable:!1})}return Ee(t,r,n)}:Ee:function(t,r,n){if(ce(t),r=It(r),ce(n),Fi)try{return Ee(t,r,n)}catch{}if("get"in n||"set"in n)throw ki("Accessors not supported");return"value"in n&&(t[r]=n.value),t};var zi=F,Bi=he,Wi=Yt,fr=zi?function(e,t,r){return Bi.f(e,t,Wi(1,r))}:function(e,t,r){return e[t]=r,e},yr={exports:{}},He=F,Ui=L,gr=Function.prototype,qi=He&&Object.getOwnPropertyDescriptor,tt=Ui(gr,"name"),Gi=tt&&(function(){}).name==="something",xi=tt&&(!He||He&&qi(gr,"name").configurable),hr={EXISTS:tt,PROPER:Gi,CONFIGURABLE:xi},Vi=T,Ji=A,ze=Xe,Yi=Vi(Function.toString);Ji(ze.inspectSource)||(ze.inspectSource=function(e){return Yi(e)});var pr=ze.inspectSource,Qi=R,Zi=A,Xi=pr,$t=Qi.WeakMap,eo=Zi($t)&&/native code/.test(Xi($t)),to=Qe.exports,ro=lr,jt=to("keys"),no=function(e){return jt[e]||(jt[e]=ro(e))},br={},io=eo,wr=R,Ne=T,oo=ee,ao=fr,Re=L,Ke=Xe,co=no,so=br,At="Object already initialized",Be=wr.TypeError,lo=wr.WeakMap,ve,J,fe,uo=function(e){return fe(e)?J(e):ve(e,{})},vo=function(e){return function(t){var r;if(!oo(t)||(r=J(t)).type!==e)throw Be("Incompatible receiver, "+e+" required");return r}};if(io||Ke.state){var B=Ke.state||(Ke.state=new lo),fo=Ne(B.get),Et=Ne(B.has),yo=Ne(B.set);ve=function(e,t){if(Et(B,e))throw new Be(At);return t.facade=e,yo(B,e,t),t},J=function(e){return fo(B,e)||{}},fe=function(e){return Et(B,e)}}else{var x=co("state");so[x]=!0,ve=function(e,t){if(Re(e,x))throw new Be(At);return t.facade=e,ao(e,x,t),t},J=function(e){return Re(e,x)?e[x]:{}},fe=function(e){return Re(e,x)}}var go={set:ve,get:J,has:fe,enforce:uo,getterFor:vo},ho=M,po=A,se=L,We=F,bo=hr.CONFIGURABLE,wo=pr,Sr=go,So=Sr.enforce,mo=Sr.get,le=Object.defineProperty,_o=We&&!ho(function(){return le(function(){},"length",{value:8}).length!==8}),Oo=String(String).split("String"),Io=yr.exports=function(e,t,r){String(t).slice(0,7)==="Symbol("&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!se(e,"name")||bo&&e.name!==t)&&(We?le(e,"name",{value:t,configurable:!0}):e.name=t),_o&&r&&se(r,"arity")&&e.length!==r.arity&&le(e,"length",{value:r.arity});try{r&&se(r,"constructor")&&r.constructor?We&&le(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var n=So(e);return se(n,"source")||(n.source=Oo.join(typeof t=="string"?t:"")),e};Function.prototype.toString=Io(function(){return po(this)&&mo(this).source||wo(this)},"toString");var $o=A,jo=he,Ao=yr.exports,Eo=Ze,mr=function(e,t,r,n){n||(n={});var i=n.enumerable,a=n.name!==void 0?n.name:t;if($o(r)&&Ao(r,a,n),n.global)i?e[t]=r:Eo(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch{}i?e[t]=r:jo.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},_r={},Po=Math.ceil,Mo=Math.floor,To=Math.trunc||function(t){var r=+t;return(r>0?Mo:Po)(r)},No=To,Or=function(e){var t=+e;return t!==t||t===0?0:No(t)},Ro=Or,Ko=Math.max,Do=Math.min,Co=function(e,t){var r=Ro(e);return r<0?Ko(r+t,0):Do(r,t)},Fo=Or,Lo=Math.min,ko=function(e){return e>0?Lo(Fo(e),9007199254740991):0},Ho=ko,zo=function(e){return Ho(e.length)},Bo=Je,Wo=Co,Uo=zo,Pt=function(e){return function(t,r,n){var i=Bo(t),a=Uo(i),c=Wo(n,a),s;if(e&&r!=r){for(;a>c;)if(s=i[c++],s!=s)return!0}else for(;a>c;c++)if((e||c in i)&&i[c]===r)return e||c||0;return!e&&-1}},qo={includes:Pt(!0),indexOf:Pt(!1)},Go=T,De=L,xo=Je,Vo=qo.indexOf,Jo=br,Mt=Go([].push),Ir=function(e,t){var r=xo(e),n=0,i=[],a;for(a in r)!De(Jo,a)&&De(r,a)&&Mt(i,a);for(;t.length>n;)De(r,a=t[n++])&&(~Vo(i,a)||Mt(i,a));return i},$r=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Yo=Ir,Qo=$r,Zo=Qo.concat("length","prototype");_r.f=Object.getOwnPropertyNames||function(t){return Yo(t,Zo)};var rt={};rt.f=Object.getOwnPropertySymbols;var Xo=Ye,ea=T,ta=_r,ra=rt,na=pe,ia=ea([].concat),oa=Xo("Reflect","ownKeys")||function(t){var r=ta.f(na(t)),n=ra.f;return n?ia(r,n(t)):r},Tt=L,aa=oa,ca=xe,sa=he,la=function(e,t,r){for(var n=aa(t),i=sa.f,a=ca.f,c=0;c<n.length;c++){var s=n[c];!Tt(e,s)&&!(r&&Tt(r,s))&&i(e,s,a(t,s))}},ua=M,da=A,va=/#|\.prototype\./,te=function(e,t){var r=ya[fa(e)];return r==ha?!0:r==ga?!1:da(t)?ua(t):!!t},fa=te.normalize=function(e){return String(e).replace(va,".").toLowerCase()},ya=te.data={},ga=te.NATIVE="N",ha=te.POLYFILL="P",pa=te,Ce=R,ba=xe.f,wa=fr,Sa=mr,ma=Ze,_a=la,Oa=pa,Ia=function(e,t){var r=e.target,n=e.global,i=e.stat,a,c,s,u,d,o;if(n?c=Ce:i?c=Ce[r]||ma(r,{}):c=(Ce[r]||{}).prototype,c)for(s in t){if(d=t[s],e.dontCallGetSet?(o=ba(c,s),u=o&&o.value):u=c[s],a=Oa(n?s:r+(i?".":"#")+s,e.forced),!a&&u!==void 0){if(typeof d==typeof u)continue;_a(d,u)}(e.sham||u&&u.sham)&&wa(d,"sham",!0),Sa(c,s,d,e)}},$a=Ir,ja=$r,Aa=Object.keys||function(t){return $a(t,ja)},Nt=F,Ea=T,Pa=X,Ma=M,Fe=Aa,Ta=rt,Na=Ve,Ra=sr,Ka=tr,V=Object.assign,Rt=Object.defineProperty,Da=Ea([].concat),Ca=!V||Ma(function(){if(Nt&&V({b:1},V(Rt({},"a",{enumerable:!0,get:function(){Rt(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(i){t[i]=i}),V({},e)[r]!=7||Fe(V({},t)).join("")!=n})?function(t,r){for(var n=Ra(t),i=arguments.length,a=1,c=Ta.f,s=Na.f;i>a;)for(var u=Ka(arguments[a++]),d=c?Da(Fe(u),c(u)):Fe(u),o=d.length,l=0,f;o>l;)f=d[l++],(!Nt||Pa(s,u,f))&&(n[f]=u[f]);return n}:V,Fa=Ia,Kt=Ca;Fa({target:"Object",stat:!0,arity:2,forced:Object.assign!==Kt},{assign:Kt});function _(e,t,r,n){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function s(o){try{d(n.next(o))}catch(l){c(l)}}function u(o){try{d(n.throw(o))}catch(l){c(l)}}function d(o){o.done?a(o.value):i(o.value).then(s,u)}d((n=n.apply(e,t||[])).next())})}var La=et,ka=La("toStringTag"),jr={};jr[ka]="z";var Ha=String(jr)==="[object z]",za=Ha,Ba=A,ue=er,Wa=et,Ua=Wa("toStringTag"),qa=Object,Ga=ue(function(){return arguments}())=="Arguments",xa=function(e,t){try{return e[t]}catch{}},Va=za?ue:function(e){var t,r,n;return e===void 0?"Undefined":e===null?"Null":typeof(r=xa(t=qa(e),Ua))=="string"?r:Ga?ue(t):(n=ue(t))=="Object"&&Ba(t.callee)?"Arguments":n},Ja=Va,Ya=String,Qa=function(e){if(Ja(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Ya(e)},Za=pe,Xa=function(){var e=Za(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},ec=X,tc=L,rc=nr,nc=Xa,Dt=RegExp.prototype,ic=function(e){var t=e.flags;return t===void 0&&!("flags"in Dt)&&!tc(e,"flags")&&rc(Dt,e)?ec(nc,e):t},oc=hr.PROPER,ac=mr,cc=pe,Ct=Qa,sc=M,lc=ic,nt="toString",uc=RegExp.prototype,Ar=uc[nt],dc=sc(function(){return Ar.call({source:"a",flags:"b"})!="/a/b"}),vc=oc&&Ar.name!=nt;(dc||vc)&&ac(RegExp.prototype,nt,function(){var t=cc(this),r=Ct(t.source),n=Ct(lc(t));return"/"+r+"/"+n},{unsafe:!0});const fc=e=>_(void 0,void 0,void 0,function*(){const{store:t,logger:r,emitter:n,options:i,defaultProvider:a,defaultStrategy:c}=e,s=new Bt.HereWallet({networkId:i.network.networkId,nodeUrl:i.network.nodeUrl,defaultProvider:a,defaultStrategy:c});function u(){return _(this,void 0,void 0,function*(){r.log("HereWallet:getAccounts");const d=yield s.getAccounts(),o=[];for(let l=0;l<d.length;l++)o.push({accountId:d[l],publicKey:(yield s.signer.getPublicKey(d[l],i.network.networkId)).toString()});return o})}return{get networkId(){return s.networkId},buildImportAccountsUrl(){return`https://my.herewallet.app/import?network=${i.network.networkId}`},account(d){return _(this,void 0,void 0,function*(){return r.log("HereWallet:account"),yield s.account(d)})},switchAccount(d){return _(this,void 0,void 0,function*(){r.log("HereWallet:switchAccount"),yield s.switchAccount(d)})},getAccountId(){return _(this,void 0,void 0,function*(){return r.log("HereWallet:getAccountId"),yield s.getAccountId()})},isSignedIn(){return _(this,void 0,void 0,function*(){return r.log("HereWallet:isSignedIn"),yield s.isSignedIn()})},signIn(d){var o;return _(this,void 0,void 0,function*(){r.log("HereWallet:signIn");const l=d.contractId!==""?d.contractId:void 0;return yield s.signIn(Object.assign(Object.assign({},d),{contractId:l})),n.emit("signedIn",{contractId:d.contractId,methodNames:(o=d.methodNames)!==null&&o!==void 0?o:[],accounts:yield u()}),yield u()})},getHereBalance(){return _(this,void 0,void 0,function*(){return r.log("HereWallet:getHereBalance"),yield s.getHereBalance()})},getAvailableBalance(){return _(this,void 0,void 0,function*(){return r.log("HereWallet:getAvailableBalance"),yield s.getAvailableBalance()})},signOut(){return _(this,void 0,void 0,function*(){r.log("HereWallet:signOut"),yield s.signOut()})},getAccounts(){return _(this,void 0,void 0,function*(){return u()})},signAndSendTransaction(d){return _(this,void 0,void 0,function*(){r.log("HereWallet:signAndSendTransaction",d);const{contract:o}=t.getState();if(!s.isSignedIn||!o)throw new Error("Wallet not signed in");return yield s.signAndSendTransaction(Object.assign({receiverId:o.contractId},d))})},verifyOwner(){return _(this,void 0,void 0,function*(){throw Error("HereWallet:verifyOwner is deprecated, use signMessage method with implementation NEP0413 Standard")})},signMessage(d){return _(this,void 0,void 0,function*(){return r.log("HereWallet:signMessage",d),yield s.signMessage(d)})},signAndSendTransactions(d){return _(this,void 0,void 0,function*(){return r.log("HereWallet:signAndSendTransactions",d),yield s.signAndSendTransactions(d)})}}});var yc="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xOS43MzM1IDExLjY4MzFMMjEuNzA4OSA4TDI0LjI5ODMgMTYuNjc2NkwyMC40MTYgMTQuOTIxNUwxOS43MzM1IDExLjY4MzFaTTUuNzYzODggMTUuNTQwOUwzLjc1NTYyIDE5LjE2MjFMOS44OTYwNSAyMi4xNjYxTDE4LjM0NzMgMjEuNTgyOEw1Ljc2Mzg4IDE1LjU0MDlaTTQuNjQ0NjQgMjIuMzY5NEwyLjY0ODY1IDI1Ljk3MTNMMTQuOTA4MyAzMi4wNTc1TDM1LjMzODggMzAuODE3NEwzNy4zMzQ4IDI3LjIxNTRMMTYuOTA0MyAyOC40NTU3TDQuNjQ0NjQgMjIuMzY5NFoiIGZpbGw9IiMyQzMwMzQiLz4KPHBhdGggZD0iTTM3LjMzNTkgMjcuMjE1N0wxNi45MTEyIDI4LjQ1NjFMNC41NDYzMyAyMi4zNTU0TDE3LjkzNTggMjEuNTQ1M0w1Ljc2Mzg3IDE1LjU0MDlMMTEuNzQxIDEwLjQ3ODZMMjQuMTQwMSAxNi41NzYzTDIxLjcwOSA4TDMzLjU1NyAxMy44MUwzNy4zMzU5IDI3LjIxNTdaIiBmaWxsPSIjRkRCRjFDIi8+Cjwvc3ZnPgo=";function bc({deprecated:e=!1,iconUrl:t=yc,defaultStrategy:r,defaultProvider:n}={}){return()=>_(this,void 0,void 0,function*(){return{id:"here-wallet",type:"injected",metadata:{name:"Here Wallet",description:"Mobile wallet for NEAR Protocol",useUrlAccountImport:!0,downloadUrl:"https://herewallet.app",iconUrl:t,deprecated:e,available:!0},init:i=>fc(Object.assign(Object.assign({},i),{defaultStrategy:r,defaultProvider:n}))}})}export{bc as setupHereWallet};
